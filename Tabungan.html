<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TabunganKu - Aplikasi Tabungan Pribadi & Bersama</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                        accent: {
                            500: '#5D5CDE',
                            600: '#4c4bba',
                            700: '#3b3a99',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .fadeIn {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .slideUp {
            animation: slideUp 0.3s ease-in-out;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .badge-glow {
            animation: glow 1.5s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 5px -5px rgba(93, 92, 222, 0.5); }
            to { box-shadow: 0 0 20px 5px rgba(93, 92, 222, 0.5); }
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: confetti-fall 3s ease-in-out forwards;
            z-index: 1000;
        }
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(60vh) rotate(360deg);
                opacity: 0;
            }
        }
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            margin: 0 6px;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background: currentColor;
            border-radius: 50%;
            display: inline-block;
            margin: 0 1px;
            opacity: 0.4;
        }
        .typing-indicator span:nth-child(1) {
            animation: blink 1s infinite 0.1s;
        }
        .typing-indicator span:nth-child(2) {
            animation: blink 1s infinite 0.3s;
        }
        .typing-indicator span:nth-child(3) {
            animation: blink 1s infinite 0.5s;
        }
        @keyframes blink {
            50% { opacity: 1; }
        }
        .pulse {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-200">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Login/PIN Screen -->
        <div id="auth-screen" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex flex-col items-center justify-center p-4">
            <div class="w-full max-w-md p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg slideUp">
                <div class="text-center mb-8">
                    <div class="flex justify-center mb-2">
                        <div class="h-16 w-16 bg-accent-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-piggy-bank text-white text-2xl"></i>
                        </div>
                    </div>
                    <h1 class="text-2xl font-bold text-accent-500">TabunganKu</h1>
                    <p class="text-gray-500 dark:text-gray-400">Aplikasi Tabungan Pribadi & Bersama</p>
                </div>
                
                <div id="pin-entry" class="mb-6">
                    <p class="text-sm text-center mb-4">Masukkan PIN 4 digit untuk mengakses aplikasi</p>
                    <div class="flex justify-center space-x-3 mb-4">
                        <div class="h-12 w-12 rounded-md border-2 border-gray-300 dark:border-gray-600 flex items-center justify-center pin-dot" data-index="0"></div>
                        <div class="h-12 w-12 rounded-md border-2 border-gray-300 dark:border-gray-600 flex items-center justify-center pin-dot" data-index="1"></div>
                        <div class="h-12 w-12 rounded-md border-2 border-gray-300 dark:border-gray-600 flex items-center justify-center pin-dot" data-index="2"></div>
                        <div class="h-12 w-12 rounded-md border-2 border-gray-300 dark:border-gray-600 flex items-center justify-center pin-dot" data-index="3"></div>
                    </div>
                    <p id="pin-error" class="text-red-500 text-center text-sm mb-4 hidden">PIN salah. Silakan coba lagi.</p>
                    
                    <div class="grid grid-cols-3 gap-3">
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">1</button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">2</button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">3</button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">4</button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">5</button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">6</button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">7</button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">8</button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">9</button>
                        <button class="h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition" id="biometric-btn">
                            <i class="fas fa-fingerprint"></i>
                        </button>
                        <button class="pin-button h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition">0</button>
                        <button class="h-14 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-lg font-medium transition" id="backspace-btn">
                            <i class="fas fa-backspace"></i>
                        </button>
                    </div>
                </div>
                
                <div class="flex flex-col space-y-2">
                    <p class="text-sm text-center text-gray-400">
                        Demo: Gunakan PIN "1234" untuk masuk
                    </p>
                    <button id="app-info-btn" class="text-accent-500 text-sm text-center">
                        Tentang Aplikasi
                    </button>
                </div>
            </div>
        </div>

        <!-- 2FA Simulation Modal -->
        <div id="twofa-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp">
                <h3 class="text-lg font-semibold mb-4">Verifikasi Dua Langkah</h3>
                <p class="text-gray-500 dark:text-gray-400 mb-4">
                    Kode verifikasi telah dikirim ke nomor +62*****1234.
                    Masukkan kode 6 digit di bawah ini:
                </p>
                <div class="flex justify-between mb-6">
                    <input type="text" maxlength="1" class="w-10 h-12 text-center text-lg border-2 border-gray-300 dark:border-gray-600 rounded-md twofa-input" />
                    <input type="text" maxlength="1" class="w-10 h-12 text-center text-lg border-2 border-gray-300 dark:border-gray-600 rounded-md twofa-input" />
                    <input type="text" maxlength="1" class="w-10 h-12 text-center text-lg border-2 border-gray-300 dark:border-gray-600 rounded-md twofa-input" />
                    <input type="text" maxlength="1" class="w-10 h-12 text-center text-lg border-2 border-gray-300 dark:border-gray-600 rounded-md twofa-input" />
                    <input type="text" maxlength="1" class="w-10 h-12 text-center text-lg border-2 border-gray-300 dark:border-gray-600 rounded-md twofa-input" />
                    <input type="text" maxlength="1" class="w-10 h-12 text-center text-lg border-2 border-gray-300 dark:border-gray-600 rounded-md twofa-input" />
                </div>
                <div class="flex justify-between">
                    <button id="twofa-cancel" class="px-4 py-2 text-accent-500 border border-accent-500 rounded-md hover:bg-accent-500 hover:text-white transition">
                        Batal
                    </button>
                    <button id="twofa-verify" class="px-4 py-2 bg-accent-500 text-white rounded-md hover:bg-accent-600 transition">
                        Verifikasi
                    </button>
                </div>
                <p class="text-sm text-center text-gray-400 mt-4">
                    Demo: Kode "123456" akan berhasil
                </p>
            </div>
        </div>

        <!-- App Info Modal -->
        <div id="app-info-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Tentang TabunganKu</h3>
                    <button id="app-info-close" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="space-y-4">
                    <p>TabunganKu adalah aplikasi tabungan pribadi dan bersama yang memungkinkan pengguna untuk:</p>
                    <ul class="list-disc pl-6 space-y-2">
                        <li>Mengelola target tabungan pribadi dengan pelacakan progress</li>
                        <li>Membuat grup tabungan bersama teman dan keluarga</li>
                        <li>Melacak setoran dan penarikan</li>
                        <li>Mengatur notifikasi dan pengingat untuk menabung secara rutin</li>
                        <li>Visualisasi progres tabungan dengan grafik</li>
                        <li>Fitur keamanan dengan PIN dan verifikasi dua langkah</li>
                        <li>Kumpulkan badge dan rewards untuk penabung aktif</li>
                        <li>AI Advisor untuk tips dan rekomendasi keuangan personalisasi</li>
                    </ul>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">
                        Demo versi 1.0 - Data disimpan dalam localStorage browser Anda.
                    </p>
                </div>
            </div>
        </div>

        <!-- New Badge Achievement Modal -->
        <div id="badge-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp text-center">
                <div class="mb-4">
                    <h3 class="text-xl font-bold text-accent-500">Selamat!</h3>
                    <p class="text-gray-500 dark:text-gray-400">
                        Anda mendapatkan badge baru
                    </p>
                </div>
                <div class="flex justify-center mb-6">
                    <div id="badge-icon-container" class="h-32 w-32 rounded-full bg-accent-500/10 flex items-center justify-center badge-glow">
                        <i id="badge-icon" class="fas fa-award text-accent-500 text-5xl"></i>
                    </div>
                </div>
                <h4 id="badge-title" class="text-lg font-semibold mb-2">Penabung Konsisten</h4>
                <p id="badge-description" class="text-gray-500 dark:text-gray-400 mb-4">
                    Menabung secara rutin selama 7 hari berturut-turut
                </p>
                <p class="text-sm text-gray-400 dark:text-gray-500 mb-6">+25 poin untuk level kamu!</p>
                <div class="flex gap-3">
                    <button id="badge-share" class="flex-1 border border-accent-500 text-accent-500 hover:bg-accent-500 hover:text-white py-2 rounded-md transition">
                        <i class="fas fa-share-alt mr-2"></i> Bagikan
                    </button>
                    <button id="badge-close" class="flex-1 bg-accent-500 hover:bg-accent-600 text-white py-2 rounded-md transition">
                        Keren!
                    </button>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <div class="h-10 w-10 bg-accent-500 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-piggy-bank text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold text-accent-500">TabunganKu</h1>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Selamat Datang, User</p>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="mr-6 hidden sm:flex items-center px-3 py-1 bg-accent-500/10 rounded-full">
                            <div class="flex items-center mr-2">
                                <i class="fas fa-star text-yellow-500 mr-1 text-xs"></i>
                                <span class="text-sm font-medium">Level 3</span>
                            </div>
                            <div class="h-2 w-20 bg-gray-200 dark:bg-gray-700 rounded-full">
                                <div class="h-2 bg-accent-500 rounded-full" style="width: 65%"></div>
                            </div>
                            <span class="text-xs ml-2">260/400</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button id="notification-btn" class="relative p-2 text-gray-600 dark:text-gray-300 hover:text-accent-500 dark:hover:text-accent-500 transition">
                                <i class="fas fa-bell"></i>
                                <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full text-white text-xs flex items-center justify-center notification-count">3</span>
                            </button>
                            <button id="theme-toggle" class="p-2 text-gray-600 dark:text-gray-300 hover:text-accent-500 dark:hover:text-accent-500 transition">
                                <i class="fas fa-moon dark:hidden"></i>
                                <i class="fas fa-sun hidden dark:block"></i>
                            </button>
                            <div class="relative">
                                <button id="user-menu-btn" class="flex items-center">
                                    <div class="h-8 w-8 bg-accent-500 rounded-full flex items-center justify-center text-white text-sm">
                                        <i class="fas fa-user"></i>
                                    </div>
                                </button>
                                <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-10 hidden">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <i class="fas fa-user-circle mr-2"></i> Profil
                                    </a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <i class="fas fa-cog mr-2"></i> Pengaturan
                                    </a>
                                    <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <i class="fas fa-sign-out-alt mr-2"></i> Keluar
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Notification Panel -->
        <div id="notification-panel" class="fixed right-0 top-[72px] w-80 bg-white dark:bg-gray-800 shadow-lg rounded-l-lg p-4 h-[calc(100vh-72px)] transform translate-x-full transition-transform duration-200 z-40">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-semibold">Notifikasi</h3>
                <button id="notification-close" class="text-gray-500 dark:text-gray-400">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="notifications-container" class="space-y-4 overflow-y-auto h-[calc(100%-40px)]">
                <!-- Notifications are dynamically loaded here -->
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-grow py-6 px-4 sm:px-6 max-w-7xl mx-auto w-full">
            <!-- Tab Navigation -->
            <div class="mb-6 border-b border-gray-200 dark:border-gray-700 overflow-x-auto hide-scrollbar">
                <ul class="flex space-x-5 sm:space-x-6" role="tablist">
                    <li>
                        <button class="py-2 border-b-2 border-accent-500 font-medium text-accent-500 tab-btn whitespace-nowrap" data-tab="dashboard-tab">
                            <i class="fas fa-chart-pie mr-2"></i>Dashboard
                        </button>
                    </li>
                    <li>
                        <button class="py-2 border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-accent-500 dark:hover:text-accent-500 tab-btn whitespace-nowrap" data-tab="personal-tab">
                            <i class="fas fa-user mr-2"></i>Tabungan Pribadi
                        </button>
                    </li>
                    <li>
                        <button class="py-2 border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-accent-500 dark:hover:text-accent-500 tab-btn whitespace-nowrap" data-tab="group-tab">
                            <i class="fas fa-users mr-2"></i>Tabungan Bersama
                        </button>
                    </li>
                    <li>
                        <button class="py-2 border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-accent-500 dark:hover:text-accent-500 tab-btn whitespace-nowrap" data-tab="transaction-tab">
                            <i class="fas fa-exchange-alt mr-2"></i>Transaksi
                        </button>
                    </li>
                    <li>
                        <button class="py-2 border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-accent-500 dark:hover:text-accent-500 tab-btn whitespace-nowrap" data-tab="rewards-tab">
                            <i class="fas fa-award mr-2"></i>Rewards
                        </button>
                    </li>
                    <li>
                        <button class="py-2 border-b-2 border-transparent font-medium text-gray-500 dark:text-gray-400 hover:text-accent-500 dark:hover:text-accent-500 tab-btn whitespace-nowrap" data-tab="advisor-tab">
                            <i class="fas fa-robot mr-2"></i>AI Advisor
                        </button>
                    </li>
                </ul>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <!-- Total Tabungan Pribadi -->
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Total Tabungan Pribadi</p>
                                <h3 class="text-2xl font-bold" id="dashboard-personal-total">Rp 0</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-500">
                                <i class="fas fa-wallet"></i>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-green-500 flex items-center text-sm">
                                <i class="fas fa-arrow-up mr-1"></i> <span id="dashboard-personal-growth">0%</span>
                            </span>
                            <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">dari bulan lalu</span>
                        </div>
                    </div>
                    
                    <!-- Total Tabungan Bersama -->
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Total Tabungan Bersama</p>
                                <h3 class="text-2xl font-bold" id="dashboard-group-total">Rp 0</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-500">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-green-500 flex items-center text-sm">
                                <i class="fas fa-arrow-up mr-1"></i> <span id="dashboard-group-growth">0%</span>
                            </span>
                            <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">dari bulan lalu</span>
                        </div>
                    </div>
                    
                    <!-- Reward Points -->
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Poin Rewards</p>
                                <h3 class="text-2xl font-bold">260 Poin</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center text-yellow-500">
                                <i class="fas fa-star"></i>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-xs">Level 3</span>
                                <span class="text-xs">Level 4</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                <div class="bg-yellow-500 h-2.5 rounded-full" style="width: 65%"></div>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">140 poin lagi menuju Level 4</p>
                        </div>
                    </div>
                </div>

                <!-- AI Insight & Chart -->
                <div class="relative mb-6 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white shadow-lg overflow-hidden">
                    <div class="absolute top-0 right-0 mt-4 mr-4">
                        <span class="px-2 py-1 bg-white/20 rounded-full text-xs text-white">AI Insight</span>
                    </div>
                    <div class="mb-2 flex items-center">
                        <i class="fas fa-robot mr-3 text-xl"></i>
                        <h3 class="text-lg font-semibold">Rekomendasi Finansial Untuk Anda</h3>
                    </div>
                    <p class="mb-3 text-white/90">Berdasarkan pola pengeluaran, Anda bisa menghemat Rp 350.000/bulan untuk mencapai target tabungan 25% lebih cepat.</p>
                    <div class="flex gap-3">
                        <button id="view-advisor-btn" class="text-sm px-4 py-2 bg-white text-indigo-600 font-medium rounded-md hover:bg-white/90 transition">
                            Lihat Detail
                        </button>
                        <button class="text-sm px-4 py-2 bg-white/20 text-white font-medium rounded-md hover:bg-white/30 transition">
                            Terapkan Rekomendasi
                        </button>
                    </div>
                    <div class="absolute -bottom-10 -right-10 h-32 w-32 bg-white/10 rounded-full"></div>
                    <div class="absolute -bottom-5 -right-20 h-20 w-20 bg-white/10 rounded-full"></div>
                </div>

                <!-- Recent Activities & Chart -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Chart -->
                    <div class="md:col-span-2 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-semibold">Progres Tabungan</h3>
                            <select id="chart-period" class="text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md px-2 py-1">
                                <option value="daily">Hari Ini</option>
                                <option value="monthly" selected>Bulan Ini</option>
                                <option value="yearly">Tahun Ini</option>
                            </select>
                        </div>
                        <div>
                            <canvas id="savingsChart" height="200"></canvas>
                        </div>
                    </div>
                    
                    <!-- Recent Activities -->
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-semibold">Aktivitas Terbaru</h3>
                            <a href="#" class="text-sm text-accent-500 hover:underline" id="view-all-transactions">Lihat Semua</a>
                        </div>
                        <div id="recent-activities" class="space-y-4 max-h-[300px] overflow-y-auto hide-scrollbar">
                            <!-- Recent activities are loaded dynamically here -->
                            <div class="flex items-center justify-center h-20">
                                <p class="text-gray-500 dark:text-gray-400 text-sm">Tidak ada aktivitas terbaru</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Personal Savings Tab -->
            <div id="personal-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Tabungan Pribadi</h2>
                    <button id="add-personal-saving-btn" class="bg-accent-500 hover:bg-accent-600 text-white px-4 py-2 rounded-md flex items-center">
                        <i class="fas fa-plus mr-2"></i> Tambah Tabungan
                    </button>
                </div>

                <div id="personal-savings-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Personal savings are dynamically loaded here -->
                    
                    <!-- Add New Savings Card -->
                    <div class="bg-gray-100 dark:bg-gray-800/50 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-800 transition" id="add-personal-card">
                        <div class="h-12 w-12 rounded-full bg-accent-500/20 flex items-center justify-center text-accent-500 mb-3">
                            <i class="fas fa-plus text-lg"></i>
                        </div>
                        <p class="font-medium text-accent-500">Tambah Tabungan Baru</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 text-center mt-1">Atur target tabungan pribadi Anda</p>
                    </div>
                </div>
                
                <!-- Empty State for Personal Savings -->
                <div id="personal-empty-state" class="hidden">
                    <div class="flex flex-col items-center justify-center py-12 px-4 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-800/30">
                        <div class="h-20 w-20 bg-accent-500/10 rounded-full flex items-center justify-center text-accent-500 mb-4">
                            <i class="fas fa-piggy-bank text-3xl"></i>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Belum Ada Tabungan Pribadi</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-center max-w-md mb-6">
                            Mulai atur keuangan Anda dengan membuat target tabungan untuk mencapai tujuan finansial.
                        </p>
                        <button class="bg-accent-500 hover:bg-accent-600 text-white px-6 py-2 rounded-md flex items-center transition" id="empty-add-personal-btn">
                            <i class="fas fa-plus mr-2"></i> Buat Tabungan Pertama
                        </button>
                    </div>
                </div>
            </div>

            <!-- Group Savings Tab -->
            <div id="group-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Tabungan Bersama</h2>
                    <button id="add-group-saving-btn" class="bg-accent-500 hover:bg-accent-600 text-white px-4 py-2 rounded-md flex items-center">
                        <i class="fas fa-plus mr-2"></i> Buat Grup Baru
                    </button>
                </div>

                <div id="group-savings-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Group savings are dynamically loaded here -->
                    
                    <!-- Add New Group Card -->
                    <div class="bg-gray-100 dark:bg-gray-800/50 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl p-6 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-800 transition" id="add-group-card">
                        <div class="h-12 w-12 rounded-full bg-accent-500/20 flex items-center justify-center text-accent-500 mb-3">
                            <i class="fas fa-users-cog text-lg"></i>
                        </div>
                        <p class="font-medium text-accent-500">Buat Grup Tabungan Baru</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 text-center mt-1">Ajak teman dan keluarga menabung bersama</p>
                    </div>
                </div>
                
                <!-- Empty State for Group Savings -->
                <div id="group-empty-state" class="hidden">
                    <div class="flex flex-col items-center justify-center py-12 px-4 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-800/30">
                        <div class="h-20 w-20 bg-accent-500/10 rounded-full flex items-center justify-center text-accent-500 mb-4">
                            <i class="fas fa-users text-3xl"></i>
                        </div>
                        <h3 class="text-lg font-medium mb-2">Belum Ada Tabungan Bersama</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-center max-w-md mb-6">
                            Buat grup tabungan dan undang teman atau keluarga untuk mencapai tujuan keuangan bersama.
                        </p>
                        <button class="bg-accent-500 hover:bg-accent-600 text-white px-6 py-2 rounded-md flex items-center transition" id="empty-add-group-btn">
                            <i class="fas fa-plus mr-2"></i> Buat Grup Tabungan
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Transactions Tab -->
            <div id="transaction-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Riwayat Transaksi</h2>
                    <div class="flex space-x-3">
                        <button id="add-deposit-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md flex items-center">
                            <i class="fas fa-plus mr-2"></i> Setoran
                        </button>
                        <button id="add-withdraw-btn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md flex items-center">
                            <i class="fas fa-minus mr-2"></i> Penarikan
                        </button>
                    </div>
                </div>
                
                <!-- Transaction Filters -->
                <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm mb-6">
                    <div class="flex flex-col sm:flex-row sm:items-center gap-4">
                        <div class="sm:w-1/3">
                            <label for="transaction-type-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Jenis Transaksi</label>
                            <select id="transaction-type-filter" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800">
                                <option value="all">Semua</option>
                                <option value="deposit">Setoran</option>
                                <option value="withdraw">Penarikan</option>
                            </select>
                        </div>
                        <div class="sm:w-1/3">
                            <label for="transaction-saving-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tabungan</label>
                            <select id="transaction-saving-filter" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800">
                                <option value="all">Semua Tabungan</option>
                                <!-- Tabungan options loaded dynamically -->
                            </select>
                        </div>
                        <div class="sm:w-1/3">
                            <label for="transaction-date-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Waktu</label>
                            <select id="transaction-date-filter" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800">
                                <option value="all">Semua Waktu</option>
                                <option value="today">Hari Ini</option>
                                <option value="week">Minggu Ini</option>
                                <option value="month">Bulan Ini</option>
                                <option value="year">Tahun Ini</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Transactions List -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <h3 class="font-semibold">Semua Transaksi</h3>
                        <div class="text-sm text-gray-500 dark:text-gray-400">
                            Total: <span id="transaction-count">0</span> transaksi
                        </div>
                    </div>
                    
                    <!-- Transactions Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        Tanggal
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        Tabungan
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        Jenis
                                    </th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        Jumlah
                                    </th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                                        Aksi
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="transactions-tbody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Transactions rows loaded dynamically -->
                                <tr>
                                    <td colspan="5" class="px-6 py-10 text-center text-gray-500 dark:text-gray-400">
                                        Tidak ada transaksi untuk ditampilkan
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">Halaman 1 dari 1</span>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Rewards Tab -->
            <div id="rewards-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-bold mb-2">Rewards & Achievements</h2>
                    <p class="text-gray-500 dark:text-gray-400">Kumpulkan badge dan tingkatkan level untuk mendapatkan rewards</p>
                </div>
                
                <!-- Level Progress -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 mb-6">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6">
                        <div class="mb-4 sm:mb-0">
                            <h3 class="text-lg font-semibold mb-1">Level 3 - Penabung Aktif</h3>
                            <p class="text-gray-500 dark:text-gray-400 text-sm">260 poin dari total 2,500 poin</p>
                        </div>
                        <div class="flex items-center space-x-2 bg-accent-500/10 px-4 py-2 rounded-lg">
                            <i class="fas fa-star text-yellow-500"></i>
                            <span class="font-bold">260 Poin</span>
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <div class="flex justify-between mb-1 text-sm">
                            <span>Level 3</span>
                            <span>Level 4 (400 poin)</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                            <div class="bg-gradient-to-r from-accent-500 to-purple-500 h-2.5 rounded-full" style="width: 65%"></div>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">140 poin lagi untuk naik ke Level 4</p>
                    </div>
                    
                    <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                        <h4 class="font-semibold mb-2">Level Berikutnya Unlocks:</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                <i class="fas fa-medal text-accent-500 mr-3"></i>
                                <span class="text-sm">Akses ke badge eksklusif</span>
                            </div>
                            <div class="flex items-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                <i class="fas fa-chart-line text-green-500 mr-3"></i>
                                <span class="text-sm">Laporan keuangan bulanan</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- My Badges -->
                <h3 class="font-semibold text-lg mb-4">Badge Saya</h3>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-8">
                    <!-- Badge: Penabung Konsisten -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 flex flex-col items-center text-center">
                        <div class="h-16 w-16 rounded-full bg-accent-500/10 flex items-center justify-center mb-3">
                            <i class="fas fa-award text-accent-500 text-2xl"></i>
                        </div>
                        <h4 class="font-semibold text-sm mb-1">Penabung Konsisten</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Menabung 7 hari berturut-turut</p>
                        <span class="mt-2 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full text-xs">Diperoleh</span>
                    </div>
                    
                    <!-- Badge: Target Pertama -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 flex flex-col items-center text-center">
                        <div class="h-16 w-16 rounded-full bg-accent-500/10 flex items-center justify-center mb-3">
                            <i class="fas fa-bullseye text-accent-500 text-2xl"></i>
                        </div>
                        <h4 class="font-semibold text-sm mb-1">Target Pertama</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Mencapai 1 target tabungan</p>
                        <span class="mt-2 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full text-xs">Diperoleh</span>
                    </div>
                    
                    <!-- Badge: Team Player -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 flex flex-col items-center text-center">
                        <div class="h-16 w-16 rounded-full bg-accent-500/10 flex items-center justify-center mb-3">
                            <i class="fas fa-users text-accent-500 text-2xl"></i>
                        </div>
                        <h4 class="font-semibold text-sm mb-1">Team Player</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Bergabung dengan grup tabungan</p>
                        <span class="mt-2 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full text-xs">Diperoleh</span>
                    </div>
                    
                    <!-- Badge: AI Assistant -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 flex flex-col items-center text-center">
                        <div class="h-16 w-16 rounded-full bg-accent-500/10 flex items-center justify-center mb-3">
                            <i class="fas fa-robot text-accent-500 text-2xl"></i>
                        </div>
                        <h4 class="font-semibold text-sm mb-1">Smart Saver</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Menggunakan AI Advisor</p>
                        <span class="mt-2 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full text-xs">Diperoleh</span>
                    </div>
                    
                    <!-- Badge: Planner -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 flex flex-col items-center text-center relative group">
                        <div class="absolute inset-0 bg-gray-200/50 dark:bg-gray-700/50 rounded-xl flex items-center justify-center z-10 backdrop-blur-[1px] group-hover:opacity-80">
                            <div class="bg-white dark:bg-gray-800 px-2 py-1 rounded">
                                <i class="fas fa-lock text-gray-500"></i>
                            </div>
                        </div>
                        <div class="h-16 w-16 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mb-3">
                            <i class="fas fa-calendar-check text-gray-400 dark:text-gray-500 text-2xl"></i>
                        </div>
                        <h4 class="font-semibold text-sm mb-1">Planner</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Buat 5 target tabungan</p>
                        <span class="mt-2 px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 rounded-full text-xs">2/5 selesai</span>
                    </div>
                </div>
                
                <!-- Available Badges -->
                <h3 class="font-semibold text-lg mb-4">Badge yang Bisa Diperoleh</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <!-- Badge Group: Tabungan Pribadi -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                        <div class="p-4 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-100 dark:border-blue-800">
                            <h4 class="font-semibold">Tabungan Pribadi</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                    <i class="fas fa-piggy-bank text-gray-500 dark:text-gray-400"></i>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium">Tabungan Konsisten</h5>
                                    <div class="flex items-center mt-1">
                                        <div class="w-24 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mr-2">
                                            <div class="h-1.5 bg-blue-500 rounded-full" style="width: 70%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">7/10 minggu</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                    <i class="fas fa-chart-line text-gray-500 dark:text-gray-400"></i>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium">Growth Master</h5>
                                    <div class="flex items-center mt-1">
                                        <div class="w-24 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mr-2">
                                            <div class="h-1.5 bg-blue-500 rounded-full" style="width: 30%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">15% dari 50%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Badge Group: Tabungan Bersama -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                        <div class="p-4 bg-purple-50 dark:bg-purple-900/20 border-b border-purple-100 dark:border-purple-800">
                            <h4 class="font-semibold">Tabungan Bersama</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                    <i class="fas fa-user-friends text-gray-500 dark:text-gray-400"></i>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium">Kontributor Aktif</h5>
                                    <div class="flex items-center mt-1">
                                        <div class="w-24 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mr-2">
                                            <div class="h-1.5 bg-purple-500 rounded-full" style="width: 60%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">3/5 kontribusi</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                    <i class="fas fa-crown text-gray-500 dark:text-gray-400"></i>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium">Group Leader</h5>
                                    <div class="flex items-center mt-1">
                                        <div class="w-24 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mr-2">
                                            <div class="h-1.5 bg-purple-500 rounded-full" style="width: 25%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">1/4 grup dibuat</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Badge Group: Milestone -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                        <div class="p-4 bg-green-50 dark:bg-green-900/20 border-b border-green-100 dark:border-green-800">
                            <h4 class="font-semibold">Milestone Tabungan</h4>
                        </div>
                        <div class="p-4 space-y-4">
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                    <i class="fas fa-gem text-gray-500 dark:text-gray-400"></i>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium">Millionaire</h5>
                                    <div class="flex items-center mt-1">
                                        <div class="w-24 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mr-2">
                                            <div class="h-1.5 bg-green-500 rounded-full" style="width: 95%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">95% complete</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <div class="h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mr-3">
                                    <i class="fas fa-trophy text-gray-500 dark:text-gray-400"></i>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium">Target Champion</h5>
                                    <div class="flex items-center mt-1">
                                        <div class="w-24 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mr-2">
                                            <div class="h-1.5 bg-green-500 rounded-full" style="width: 40%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">2/5 target tercapai</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Advisor Tab -->
            <div id="advisor-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-bold mb-2">AI Financial Advisor</h2>
                    <p class="text-gray-500 dark:text-gray-400">Dapatkan insight dan rekomendasi cerdas untuk mencapai tujuan finansial Anda</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- AI Chat Section -->
                    <div class="lg:col-span-2">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden flex flex-col h-[600px]">
                            <!-- Chat Header -->
                            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center">
                                <div class="h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-500 mr-3">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">Financial Advisor AI</h3>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Selalu siap membantu keuangan Anda</p>
                                </div>
                            </div>
                            
                            <!-- Chat Messages -->
                            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-4">
                                <!-- AI Welcome Message -->
                                <div class="flex items-start">
                                    <div class="h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-500 mr-2 flex-shrink-0">
                                        <i class="fas fa-robot text-sm"></i>
                                    </div>
                                    <div class="bg-gray-100 dark:bg-gray-700 rounded-lg rounded-tl-none p-3 max-w-[85%]">
                                        <p class="text-sm">Halo! Saya Financial Advisor AI yang akan membantu Anda mencapai tujuan keuangan. Berdasarkan data tabungan Anda, saya melihat beberapa peluang untuk meningkatkan kondisi keuangan Anda. Apa yang ingin Anda ketahui hari ini?</p>
                                    </div>
                                </div>
                                
                                <!-- User Message -->
                                <div class="flex items-start justify-end">
                                    <div class="bg-accent-500 text-white rounded-lg rounded-tr-none p-3 max-w-[85%]">
                                        <p class="text-sm">Bagaimana cara saya bisa mencapai target tabungan lebih cepat?</p>
                                    </div>
                                    <div class="h-8 w-8 rounded-full bg-accent-500 flex items-center justify-center text-white ml-2 flex-shrink-0">
                                        <i class="fas fa-user text-sm"></i>
                                    </div>
                                </div>
                                
                                <!-- AI Response -->
                                <div class="flex items-start">
                                    <div class="h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-500 mr-2 flex-shrink-0">
                                        <i class="fas fa-robot text-sm"></i>
                                    </div>
                                    <div class="bg-gray-100 dark:bg-gray-700 rounded-lg rounded-tl-none p-3 max-w-[85%]">
                                        <p class="text-sm">Berdasarkan analisis pola keuangan Anda, saya menemukan beberapa peluang:</p>
                                        <ul class="list-disc pl-4 mt-2 text-sm space-y-1">
                                            <li>Potensi menghemat Rp 350.000/bulan dari biaya berlangganan yang jarang digunakan</li>
                                            <li>Dengan menabung secara konsisten setiap minggu, Anda bisa mencapai target "Liburan Bali" 1 bulan lebih cepat</li>
                                            <li>Mengalokasikan 20% dari pendapatan untuk Dana Darurat akan membuat target tercapai dalam 4 bulan</li>
                                        </ul>
                                        <p class="text-sm mt-2">Saya bisa membantu Anda membuat rencana anggaran yang lebih detail. Tertarik?</p>
                                    </div>
                                </div>
                                
                                <!-- User Message -->
                                <div class="flex items-start justify-end">
                                    <div class="bg-accent-500 text-white rounded-lg rounded-tr-none p-3 max-w-[85%]">
                                        <p class="text-sm">Ya, tolong buatkan rencana anggaran untuk saya</p>
                                    </div>
                                    <div class="h-8 w-8 rounded-full bg-accent-500 flex items-center justify-center text-white ml-2 flex-shrink-0">
                                        <i class="fas fa-user text-sm"></i>
                                    </div>
                                </div>
                                
                                <!-- AI Typing Indicator -->
                                <div id="typing-indicator" class="flex items-start">
                                    <div class="h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-500 mr-2 flex-shrink-0">
                                        <i class="fas fa-robot text-sm"></i>
                                    </div>
                                    <div class="bg-gray-100 dark:bg-gray-700 rounded-lg rounded-tl-none p-3">
                                        <div class="typing-indicator text-gray-500 dark:text-gray-400">
                                            <span></span>
                                            <span></span>
                                            <span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Chat Input -->
                            <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                                <form id="chat-form" class="flex gap-2">
                                    <input type="text" id="chat-input" class="flex-grow px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Tanyakan sesuatu tentang keuangan Anda...">
                                    <button type="submit" class="px-4 py-2 bg-accent-500 text-white rounded-md hover:bg-accent-600 transition flex-shrink-0">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Recommendations & Tools -->
                    <div class="space-y-6">
                        <!-- Financial Health Card -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                            <div class="p-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white">
                                <div class="flex justify-between items-center mb-1">
                                    <h3 class="font-semibold">Kesehatan Finansial</h3>
                                    <span class="text-xs bg-white/20 px-2 py-0.5 rounded-full">Updated Today</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="h-10 w-10 rounded-full bg-white/20 flex items-center justify-center mr-3">
                                        <i class="fas fa-heartbeat text-white"></i>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold">76/100</div>
                                        <div class="text-xs text-white/80">Baik - Ada ruang untuk perbaikan</div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4">
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Rasio Darurat</div>
                                        <div class="font-semibold">3.6 bulan</div>
                                        <div class="flex items-center mt-1">
                                            <div class="w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-full">
                                                <div class="h-1 bg-green-500 rounded-full" style="width: 72%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700/50 p-3 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Rasio Tabungan</div>
                                        <div class="font-semibold">18%</div>
                                        <div class="flex items-center mt-1">
                                            <div class="w-full h-1 bg-gray-200 dark:bg-gray-700 rounded-full">
                                                <div class="h-1 bg-yellow-500 rounded-full" style="width: 60%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button class="w-full text-center text-sm text-accent-500 hover:text-accent-600">
                                    Lihat analisis lengkap <i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Personalized Recommendations -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                                <h3 class="font-semibold">Rekomendasi Untuk Anda</h3>
                            </div>
                            <div class="p-4 space-y-4">
                                <div class="flex items-start">
                                    <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-500 mr-3 flex-shrink-0">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium">Optimalkan Tabungan Darurat</h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Tingkatkan dana darurat Anda hingga 6 bulan pengeluaran untuk keamanan finansial yang lebih baik.</p>
                                        <button class="text-xs text-accent-500 mt-1">Lihat rencana <i class="fas fa-arrow-right ml-1"></i></button>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="h-8 w-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-500 mr-3 flex-shrink-0">
                                        <i class="fas fa-calendar-alt"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium">Jadwalkan Auto Debit</h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Aktifkan setoran otomatis mingguan sebesar Rp 250.000 untuk Dana Pendidikan.</p>
                                        <button class="text-xs text-accent-500 mt-1">Atur sekarang <i class="fas fa-arrow-right ml-1"></i></button>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <div class="h-8 w-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-red-500 mr-3 flex-shrink-0">
                                        <i class="fas fa-exclamation-circle"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium">Langganan Yang Tidak Digunakan</h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Temukan Rp 350.000/bulan dari langganan yang jarang digunakan untuk dialokasikan ke tabungan.</p>
                                        <button class="text-xs text-accent-500 mt-1">Review langganan <i class="fas fa-arrow-right ml-1"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Budget Planner Tool -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden relative group cursor-pointer pulse">
                            <div class="p-6 text-center">
                                <div class="h-12 w-12 mx-auto rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-500 mb-3">
                                    <i class="fas fa-calculator"></i>
                                </div>
                                <h3 class="font-semibold mb-2">Budget Planner AI</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Buat rencana anggaran cerdas yang sesuai dengan gaya hidup dan tujuan finansial Anda.</p>
                                <button class="px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 transition text-sm">
                                    Buat Anggaran
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Add Personal Saving Modal -->
        <div id="add-personal-saving-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold" id="personal-saving-modal-title">Tambah Tabungan Baru</h3>
                    <button class="modal-close text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="personal-saving-form" class="space-y-4">
                    <input type="hidden" id="personal-saving-id" name="personal-saving-id" value="">
                    <div>
                        <label for="saving-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nama Tabungan</label>
                        <input type="text" id="saving-name" name="saving-name" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Contoh: Liburan Bali" required>
                    </div>
                    <div>
                        <label for="saving-category" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Kategori</label>
                        <select id="saving-category" name="saving-category" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800">
                            <option value="liburan">Liburan</option>
                            <option value="pendidikan">Pendidikan</option>
                            <option value="kendaraan">Kendaraan</option>
                            <option value="elektronik">Elektronik</option>
                            <option value="rumah">Rumah</option>
                            <option value="darurat">Dana Darurat</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div>
                        <label for="saving-target" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Target Jumlah (Rp)</label>
                        <input type="number" id="saving-target" name="saving-target" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Contoh: 10000000" required>
                    </div>
                    <div>
                        <label for="saving-deadline" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tenggat Waktu</label>
                        <input type="date" id="saving-deadline" name="saving-deadline" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800">
                    </div>
                    <div>
                        <label for="saving-init" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Setoran Awal (Rp)</label>
                        <input type="number" id="saving-init" name="saving-init" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Contoh: 1000000">
                    </div>
                    <div>
                        <label for="saving-notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Catatan (Opsional)</label>
                        <textarea id="saving-notes" name="saving-notes" rows="3" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Catatan tambahan..."></textarea>
                    </div>
                    <div class="pt-3 flex gap-2">
                        <button type="submit" class="flex-grow bg-accent-500 hover:bg-accent-600 text-white py-2 rounded-md transition">
                            Simpan
                        </button>
                        <button type="button" id="delete-personal-saving-btn" class="hidden px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md transition">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Group Saving Modal -->
        <div id="add-group-saving-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold" id="group-saving-modal-title">Buat Grup Tabungan Baru</h3>
                    <button class="modal-close text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="group-saving-form" class="space-y-4">
                    <input type="hidden" id="group-saving-id" name="group-saving-id" value="">
                    <div>
                        <label for="group-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nama Grup</label>
                        <input type="text" id="group-name" name="group-name" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Contoh: Liburan Bersama" required>
                    </div>
                    <div>
                        <label for="group-category" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Kategori</label>
                        <select id="group-category" name="group-category" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800">
                            <option value="liburan">Liburan</option>
                            <option value="acara">Acara</option>
                            <option value="hadiah">Hadiah</option>
                            <option value="arisan">Arisan</option>
                            <option value="donasi">Donasi</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div>
                        <label for="group-target" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Target Jumlah (Rp)</label>
                        <input type="number" id="group-target" name="group-target" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Contoh: 20000000" required>
                    </div>
                    <div>
                        <label for="group-deadline" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tenggat Waktu</label>
                        <input type="date" id="group-deadline" name="group-deadline" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800">
                    </div>
                    <div>
                        <label for="group-members" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tambah Anggota (Email/Username)</label>
                        <div class="flex">
                            <input type="text" id="group-members" name="group-members" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-l-md bg-white dark:bg-gray-800" placeholder="Contoh: email@example.com">
                            <button type="button" id="add-member-btn" class="bg-accent-500 hover:bg-accent-600 text-white px-3 py-2 rounded-r-md transition">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div id="members-list" class="space-y-2 pt-2">
                        <!-- Members will be added here dynamically -->
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Pengaturan Privasi</label>
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="group-privacy" name="group-privacy" class="h-4 w-4 text-accent-500 focus:ring-accent-500 border-gray-300 rounded">
                            <label for="group-privacy" class="text-sm text-gray-700 dark:text-gray-300">Hanya admin yang dapat melihat total saldo</label>
                        </div>
                    </div>
                    <div class="pt-3 flex gap-2">
                        <button type="submit" class="flex-grow bg-accent-500 hover:bg-accent-600 text-white py-2 rounded-md transition">
                            Simpan
                        </button>
                        <button type="button" id="delete-group-saving-btn" class="hidden px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md transition">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Transaction Modal (for both deposit and withdrawal) -->
        <div id="transaction-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold" id="transaction-modal-title">Tambah Setoran</h3>
                    <button id="transaction-close" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="transaction-form" class="space-y-4">
                    <input type="hidden" id="transaction-id" name="transaction-id" value="">
                    <input type="hidden" id="transaction-type" name="transaction-type" value="deposit">
                    
                    <div>
                        <label for="transaction-saving" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Pilih Tabungan</label>
                        <select id="transaction-saving" name="transaction-saving" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" required>
                            <option value="">-- Pilih Tabungan --</option>
                            <!-- Options will be loaded dynamically -->
                        </select>
                    </div>
                    
                    <div>
                        <label id="transaction-amount-label" for="transaction-amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Jumlah Setoran (Rp)</label>
                        <input type="number" id="transaction-amount" name="transaction-amount" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Contoh: 500000" required>
                    </div>
                    
                    <div>
                        <label for="transaction-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tanggal</label>
                        <input type="date" id="transaction-date" name="transaction-date" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" value="">
                    </div>
                    
                    <div>
                        <label for="transaction-payment-method" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Metode Pembayaran</label>
                        <select id="transaction-payment-method" name="transaction-payment-method" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800">
                            <option value="bank">Transfer Bank</option>
                            <option value="e-wallet">E-Wallet</option>
                            <option value="credit-card">Kartu Kredit</option>
                            <option value="cash">Tunai</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="transaction-notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Catatan (Opsional)</label>
                        <textarea id="transaction-notes" name="transaction-notes" rows="2" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800" placeholder="Catatan tambahan..."></textarea>
                    </div>
                    
                    <div class="pt-3 flex gap-2">
                        <button type="submit" class="flex-grow bg-accent-500 hover:bg-accent-600 text-white py-2 rounded-md transition" id="save-transaction-btn">
                            Simpan
                        </button>
                        <button type="button" id="delete-transaction-btn" class="hidden px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md transition">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- View Transaction Detail Modal -->
        <div id="transaction-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Detail Transaksi</h3>
                    <button id="transaction-detail-close" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="space-y-4">
                    <div id="transaction-detail-type" class="flex justify-center py-2 px-4 rounded-lg text-white font-medium mb-2">
                        <!-- Type badge will be added here -->
                    </div>
                    
                    <div class="text-center mb-4">
                        <div class="text-3xl font-bold" id="transaction-detail-amount">Rp 0</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400" id="transaction-detail-date">0000-00-00</div>
                    </div>
                    
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4 space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Tabungan</span>
                            <span class="font-medium" id="transaction-detail-saving">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Metode Pembayaran</span>
                            <span class="font-medium" id="transaction-detail-method">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500 dark:text-gray-400">Catatan</span>
                            <span class="font-medium" id="transaction-detail-notes">-</span>
                        </div>
                    </div>
                    
                    <div class="pt-4 flex space-x-2">
                        <button id="edit-transaction-btn" class="flex-grow py-2 border border-accent-500 text-accent-500 rounded-md hover:bg-accent-500 hover:text-white transition">
                            <i class="fas fa-edit mr-2"></i> Edit
                        </button>
                        <button id="view-detail-delete-transaction-btn" class="flex-grow py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition">
                            <i class="fas fa-trash mr-2"></i> Hapus
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Delete Confirmation Modal -->
        <div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp">
                <div class="text-center mb-4">
                    <div class="h-20 w-20 mx-auto rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-red-500 mb-4">
                        <i class="fas fa-exclamation-triangle text-3xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold" id="delete-confirm-title">Konfirmasi Hapus</h3>
                    <p class="text-gray-500 dark:text-gray-400 mt-1" id="delete-confirm-message">
                        Apakah Anda yakin ingin menghapus item ini? Tindakan ini tidak dapat dibatalkan.
                    </p>
                </div>
                <div class="flex space-x-2">
                    <button id="delete-cancel-btn" class="flex-grow py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        Batal
                    </button>
                    <button id="delete-confirm-btn" class="flex-grow py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition">
                        Hapus Permanen
                    </button>
                </div>
                <input type="hidden" id="delete-item-id" value="">
                <input type="hidden" id="delete-item-type" value="">
            </div>
        </div>
        
        <!-- Share Modal -->
        <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-md p-6 shadow-lg slideUp">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Bagikan Pencapaian</h3>
                    <button id="share-close" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-4">
                    <div class="flex items-center justify-center mb-3">
                        <div class="h-12 w-12 rounded-full bg-accent-500/20 flex items-center justify-center mr-3">
                            <i id="share-icon" class="fas fa-award text-accent-500 text-xl"></i>
                        </div>
                        <div>
                            <h4 id="share-title" class="font-semibold">Penabung Konsisten</h4>
                            <p id="share-description" class="text-sm text-gray-500 dark:text-gray-400">Menabung secara rutin selama 7 hari berturut-turut</p>
                        </div>
                    </div>
                    <div class="text-center">
                        <p class="text-sm">Saya baru saja mendapatkan badge ini di aplikasi TabunganKu. Ayo bergabung dan mulai menabung untuk masa depan!</p>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bagikan ke:</label>
                    <div class="grid grid-cols-4 gap-2">
                        <button class="p-3 border border-gray-300 dark:border-gray-600 rounded-md flex flex-col items-center hover:bg-blue-50 dark:hover:bg-blue-900/30 hover:border-blue-500 text-center">
                            <i class="fab fa-facebook text-blue-600 text-xl mb-1"></i>
                            <span class="text-xs">Facebook</span>
                        </button>
                        <button class="p-3 border border-gray-300 dark:border-gray-600 rounded-md flex flex-col items-center hover:bg-green-50 dark:hover:bg-green-900/30 hover:border-green-500 text-center">
                            <i class="fab fa-whatsapp text-green-600 text-xl mb-1"></i>
                            <span class="text-xs">WhatsApp</span>
                        </button>
                        <button class="p-3 border border-gray-300 dark:border-gray-600 rounded-md flex flex-col items-center hover:bg-blue-50 dark:hover:bg-blue-900/30 hover:border-blue-400 text-center">
                            <i class="fab fa-twitter text-blue-400 text-xl mb-1"></i>
                            <span class="text-xs">Twitter</span>
                        </button>
                        <button class="p-3 border border-gray-300 dark:border-gray-600 rounded-md flex flex-col items-center hover:bg-purple-50 dark:hover:bg-purple-900/30 hover:border-purple-500 text-center">
                            <i class="fab fa-instagram text-purple-500 text-xl mb-1"></i>
                            <span class="text-xs">Instagram</span>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Atau salin link:</label>
                    <div class="flex">
                        <input type="text" value="https://tabunganku.app/share/badge/12345" class="flex-grow text-sm px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-l-md bg-white dark:bg-gray-800" readonly>
                        <button class="bg-accent-500 hover:bg-accent-600 text-white px-3 py-2 rounded-r-md transition" id="copy-link-btn">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Database setup (localStorage)
            const DB = {
                personalSavings: [],
                groupSavings: [],
                transactions: [],
                notifications: [],
                
                // CRUD for personal savings
                getPersonalSavings() {
                    const savings = localStorage.getItem('personalSavings');
                    this.personalSavings = savings ? JSON.parse(savings) : [];
                    return this.personalSavings;
                },
                
                addPersonalSaving(saving) {
                    this.getPersonalSavings();
                    saving.id = this.generateId();
                    saving.created = new Date().toISOString();
                    saving.balance = parseInt(saving.initialAmount || 0);
                    this.personalSavings.push(saving);
                    localStorage.setItem('personalSavings', JSON.stringify(this.personalSavings));
                    return saving;
                },
                
                updatePersonalSaving(id, updatedSaving) {
                    this.getPersonalSavings();
                    const index = this.personalSavings.findIndex(s => s.id === id);
                    if (index !== -1) {
                        // Preserve balance and created date
                        updatedSaving.balance = this.personalSavings[index].balance;
                        updatedSaving.created = this.personalSavings[index].created;
                        this.personalSavings[index] = updatedSaving;
                        localStorage.setItem('personalSavings', JSON.stringify(this.personalSavings));
                        return updatedSaving;
                    }
                    return null;
                },
                
                deletePersonalSaving(id) {
                    this.getPersonalSavings();
                    const index = this.personalSavings.findIndex(s => s.id === id);
                    if (index !== -1) {
                        this.personalSavings.splice(index, 1);
                        localStorage.setItem('personalSavings', JSON.stringify(this.personalSavings));
                        
                        // Also delete associated transactions
                        this.deleteTransactionsBySaving(id);
                        return true;
                    }
                    return false;
                },
                
                getPersonalSavingById(id) {
                    this.getPersonalSavings();
                    return this.personalSavings.find(s => s.id === id) || null;
                },
                
                // CRUD for group savings
                getGroupSavings() {
                    const savings = localStorage.getItem('groupSavings');
                    this.groupSavings = savings ? JSON.parse(savings) : [];
                    return this.groupSavings;
                },
                
                addGroupSaving(saving) {
                    this.getGroupSavings();
                    saving.id = this.generateId();
                    saving.created = new Date().toISOString();
                    saving.balance = 0;
                    this.groupSavings.push(saving);
                    localStorage.setItem('groupSavings', JSON.stringify(this.groupSavings));
                    return saving;
                },
                
                updateGroupSaving(id, updatedSaving) {
                    this.getGroupSavings();
                    const index = this.groupSavings.findIndex(s => s.id === id);
                    if (index !== -1) {
                        // Preserve balance and created date
                        updatedSaving.balance = this.groupSavings[index].balance;
                        updatedSaving.created = this.groupSavings[index].created;
                        this.groupSavings[index] = updatedSaving;
                        localStorage.setItem('groupSavings', JSON.stringify(this.groupSavings));
                        return updatedSaving;
                    }
                    return null;
                },
                
                deleteGroupSaving(id) {
                    this.getGroupSavings();
                    const index = this.groupSavings.findIndex(s => s.id === id);
                    if (index !== -1) {
                        this.groupSavings.splice(index, 1);
                        localStorage.setItem('groupSavings', JSON.stringify(this.groupSavings));
                        
                        // Also delete associated transactions
                        this.deleteTransactionsBySaving(id);
                        return true;
                    }
                    return false;
                },
                
                getGroupSavingById(id) {
                    this.getGroupSavings();
                    return this.groupSavings.find(s => s.id === id) || null;
                },
                
                // CRUD for transactions
                getTransactions() {
                    const transactions = localStorage.getItem('transactions');
                    this.transactions = transactions ? JSON.parse(transactions) : [];
                    return this.transactions;
                },
                
                addTransaction(transaction) {
                    this.getTransactions();
                    transaction.id = this.generateId();
                    transaction.timestamp = new Date().toISOString();
                    this.transactions.push(transaction);
                    localStorage.setItem('transactions', JSON.stringify(this.transactions));
                    
                    // Update saving balance
                    this.updateSavingBalance(transaction.savingId, transaction.amount, transaction.type);
                    
                    // Add notification
                    const savingName = this.getSavingNameById(transaction.savingId);
                    const amount = this.formatCurrency(transaction.amount);
                    let message = '';
                    
                    if (transaction.type === 'deposit') {
                        message = `Setoran sebesar ${amount} berhasil ditambahkan ke "${savingName}"`;
                    } else {
                        message = `Penarikan sebesar ${amount} berhasil dilakukan dari "${savingName}"`;
                    }
                    
                    this.addNotification({
                        type: transaction.type === 'deposit' ? 'success' : 'info',
                        title: transaction.type === 'deposit' ? 'Setoran Berhasil' : 'Penarikan Berhasil',
                        message: message,
                        timestamp: new Date().toISOString()
                    });
                    
                    return transaction;
                },
                
                updateTransaction(id, updatedTransaction) {
                    this.getTransactions();
                    const index = this.transactions.findIndex(t => t.id === id);
                    if (index !== -1) {
                        // Calculate the difference in amount for balance update
                        const originalTransaction = this.transactions[index];
                        
                        // Revert the original transaction's effect on the balance
                        if (originalTransaction.savingId === updatedTransaction.savingId) {
                            // Same saving, just update amount
                            const amountDiff = updatedTransaction.amount - originalTransaction.amount;
                            if (amountDiff !== 0) {
                                this.updateSavingBalance(
                                    originalTransaction.savingId, 
                                    Math.abs(amountDiff), 
                                    amountDiff > 0 ? originalTransaction.type : (originalTransaction.type === 'deposit' ? 'withdraw' : 'deposit')
                                );
                            }
                        } else {
                            // Different saving, revert original and add new
                            this.updateSavingBalance(
                                originalTransaction.savingId, 
                                originalTransaction.amount, 
                                originalTransaction.type === 'deposit' ? 'withdraw' : 'deposit'
                            );
                            this.updateSavingBalance(
                                updatedTransaction.savingId, 
                                updatedTransaction.amount, 
                                updatedTransaction.type
                            );
                        }
                        
                        // Keep original timestamp
                        updatedTransaction.timestamp = originalTransaction.timestamp;
                        
                        // Update the transaction
                        this.transactions[index] = updatedTransaction;
                        localStorage.setItem('transactions', JSON.stringify(this.transactions));
                        
                        return updatedTransaction;
                    }
                    return null;
                },
                
                deleteTransaction(id) {
                    this.getTransactions();
                    const index = this.transactions.findIndex(t => t.id === id);
                    if (index !== -1) {
                        const transaction = this.transactions[index];
                        
                        // Revert the transaction's effect on the balance
                        this.updateSavingBalance(
                            transaction.savingId, 
                            transaction.amount, 
                            transaction.type === 'deposit' ? 'withdraw' : 'deposit'
                        );
                        
                        this.transactions.splice(index, 1);
                        localStorage.setItem('transactions', JSON.stringify(this.transactions));
                        return true;
                    }
                    return false;
                },
                
                getTransactionById(id) {
                    this.getTransactions();
                    return this.transactions.find(t => t.id === id) || null;
                },
                
                getTransactionsBySaving(savingId) {
                    this.getTransactions();
                    return this.transactions.filter(t => t.savingId === savingId);
                },
                
                deleteTransactionsBySaving(savingId) {
                    this.getTransactions();
                    this.transactions = this.transactions.filter(t => t.savingId !== savingId);
                    localStorage.setItem('transactions', JSON.stringify(this.transactions));
                },
                
                getFilteredTransactions(filters = {}) {
                    this.getTransactions();
                    let filtered = [...this.transactions];
                    
                    // Apply type filter
                    if (filters.type && filters.type !== 'all') {
                        filtered = filtered.filter(t => t.type === filters.type);
                    }
                    
                    // Apply saving filter
                    if (filters.savingId && filters.savingId !== 'all') {
                        filtered = filtered.filter(t => t.savingId === filters.savingId);
                    }
                    
                    // Apply date filter
                    if (filters.dateRange && filters.dateRange !== 'all') {
                        const now = new Date();
                        let startDate = new Date();
                        
                        switch (filters.dateRange) {
                            case 'today':
                                startDate.setHours(0, 0, 0, 0);
                                break;
                            case 'week':
                                startDate.setDate(now.getDate() - 7);
                                break;
                            case 'month':
                                startDate.setMonth(now.getMonth() - 1);
                                break;
                            case 'year':
                                startDate.setFullYear(now.getFullYear() - 1);
                                break;
                        }
                        
                        filtered = filtered.filter(t => new Date(t.timestamp) >= startDate);
                    }
                    
                    // Sort by date (newest first)
                    filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    return filtered;
                },
                
                // CRUD for notifications
                getNotifications() {
                    const notifications = localStorage.getItem('notifications');
                    this.notifications = notifications ? JSON.parse(notifications) : [];
                    return this.notifications;
                },
                
                addNotification(notification) {
                    this.getNotifications();
                    notification.id = this.generateId();
                    notification.timestamp = new Date().toISOString();
                    notification.read = false;
                    
                    // Add to the beginning of the array (newest first)
                    this.notifications.unshift(notification);
                    
                    // Keep only the latest 50 notifications
                    if (this.notifications.length > 50) {
                        this.notifications = this.notifications.slice(0, 50);
                    }
                    
                    localStorage.setItem('notifications', JSON.stringify(this.notifications));
                    this.updateNotificationBadge();
                    return notification;
                },
                
                markNotificationAsRead(id) {
                    this.getNotifications();
                    const notification = this.notifications.find(n => n.id === id);
                    if (notification) {
                        notification.read = true;
                        localStorage.setItem('notifications', JSON.stringify(this.notifications));
                        this.updateNotificationBadge();
                        return true;
                    }
                    return false;
                },
                
                markAllNotificationsAsRead() {
                    this.getNotifications();
                    this.notifications.forEach(n => n.read = true);
                    localStorage.setItem('notifications', JSON.stringify(this.notifications));
                    this.updateNotificationBadge();
                },
                
                deleteNotification(id) {
                    this.getNotifications();
                    const index = this.notifications.findIndex(n => n.id === id);
                    if (index !== -1) {
                        this.notifications.splice(index, 1);
                        localStorage.setItem('notifications', JSON.stringify(this.notifications));
                        this.updateNotificationBadge();
                        return true;
                    }
                    return false;
                },
                
                updateNotificationBadge() {
                    const unreadCount = this.notifications.filter(n => !n.read).length;
                    const badge = document.querySelector('.notification-count');
                    if (badge) {
                        if (unreadCount > 0) {
                            badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                            badge.classList.remove('hidden');
                        } else {
                            badge.classList.add('hidden');
                        }
                    }
                },
                
                // Utility functions
                generateId() {
                    return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                },
                
                updateSavingBalance(savingId, amount, type) {
                    // Check if it's a personal saving
                    let personal = this.getPersonalSavingById(savingId);
                    if (personal) {
                        if (type === 'deposit') {
                            personal.balance += parseInt(amount);
                        } else {
                            personal.balance -= parseInt(amount);
                        }
                        this.updatePersonalSaving(savingId, personal);
                        return;
                    }
                    
                    // Check if it's a group saving
                    let group = this.getGroupSavingById(savingId);
                    if (group) {
                        if (type === 'deposit') {
                            group.balance += parseInt(amount);
                        } else {
                            group.balance -= parseInt(amount);
                        }
                        this.updateGroupSaving(savingId, group);
                        return;
                    }
                },
                
                getSavingNameById(savingId) {
                    // Check personal savings first
                    const personal = this.getPersonalSavingById(savingId);
                    if (personal) return personal.name;
                    
                    // Then check group savings
                    const group = this.getGroupSavingById(savingId);
                    if (group) return group.name;
                    
                    return 'Unknown Saving';
                },
                
                formatCurrency(amount) {
                    return new Intl.NumberFormat('id-ID', {
                        style: 'currency',
                        currency: 'IDR',
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    }).format(amount);
                },
                
                formatDate(dateString) {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                },
                
                // Statistics for dashboard
                getPersonalTotalBalance() {
                    this.getPersonalSavings();
                    return this.personalSavings.reduce((total, saving) => total + saving.balance, 0);
                },
                
                getGroupTotalBalance() {
                    this.getGroupSavings();
                    return this.groupSavings.reduce((total, saving) => total + saving.balance, 0);
                },
                
                getPersonalGrowthRate() {
                    const oneMonthAgo = new Date();
                    oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                    
                    this.getTransactions();
                    const recentTransactions = this.transactions.filter(t => {
                        const transactionDate = new Date(t.timestamp);
                        return transactionDate >= oneMonthAgo;
                    });
                    
                    // Calculate deposit and withdraw amounts for personal savings
                    let personalDeposits = 0;
                    let personalWithdraws = 0;
                    
                    recentTransactions.forEach(t => {
                        const isSavingPersonal = this.getPersonalSavingById(t.savingId) !== null;
                        if (isSavingPersonal) {
                            if (t.type === 'deposit') {
                                personalDeposits += parseInt(t.amount);
                            } else {
                                personalWithdraws += parseInt(t.amount);
                            }
                        }
                    });
                    
                    const netGrowth = personalDeposits - personalWithdraws;
                    const totalBefore = this.getPersonalTotalBalance() - netGrowth;
                    
                    if (totalBefore <= 0) return 100; // To avoid division by zero or negative
                    
                    const growthRate = (netGrowth / totalBefore) * 100;
                    return Math.round(growthRate);
                },
                
                getGroupGrowthRate() {
                    const oneMonthAgo = new Date();
                    oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                    
                    this.getTransactions();
                    const recentTransactions = this.transactions.filter(t => {
                        const transactionDate = new Date(t.timestamp);
                        return transactionDate >= oneMonthAgo;
                    });
                    
                    // Calculate deposit and withdraw amounts for group savings
                    let groupDeposits = 0;
                    let groupWithdraws = 0;
                    
                    recentTransactions.forEach(t => {
                        const isSavingGroup = this.getGroupSavingById(t.savingId) !== null;
                        if (isSavingGroup) {
                            if (t.type === 'deposit') {
                                groupDeposits += parseInt(t.amount);
                            } else {
                                groupWithdraws += parseInt(t.amount);
                            }
                        }
                    });
                    
                    const netGrowth = groupDeposits - groupWithdraws;
                    const totalBefore = this.getGroupTotalBalance() - netGrowth;
                    
                    if (totalBefore <= 0) return 100; // To avoid division by zero or negative
                    
                    const growthRate = (netGrowth / totalBefore) * 100;
                    return Math.round(growthRate);
                },
                
                getRecentTransactions(limit = 5) {
                    this.getTransactions();
                    
                    // Sort by date (newest first)
                    const sorted = [...this.transactions].sort((a, b) => 
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );
                    
                    return sorted.slice(0, limit);
                }
            };
            
            // Initialize app with data
            function initializeApp() {
                loadPersonalSavings();
                loadGroupSavings();
                loadTransactions();
                updateDashboard();
                loadNotifications();
                
                // Add some initial data if the app is empty
                if (DB.getPersonalSavings().length === 0 && DB.getGroupSavings().length === 0) {
                    createSampleData();
                }
            }
            
            // Create sample data for first-time users
            function createSampleData() {
                // Sample personal savings
                const personal1 = {
                    name: "Liburan Bali",
                    category: "liburan",
                    targetAmount: 10000000,
                    deadline: "2024-10-01",
                    initialAmount: 7000000,
                    notes: "Liburan bersama keluarga",
                    iconColor: "blue"
                };
                
                const personal2 = {
                    name: "Dana Pendidikan",
                    category: "pendidikan",
                    targetAmount: 50000000,
                    deadline: "2024-12-31",
                    initialAmount: 15000000,
                    notes: "Biaya kuliah",
                    iconColor: "green"
                };
                
                const personal3 = {
                    name: "Dana Darurat",
                    category: "darurat",
                    targetAmount: 10000000,
                    initialAmount: 6000000,
                    notes: "Simpanan untuk keadaan darurat",
                    iconColor: "red"
                };
                
                const personalSaving1 = DB.addPersonalSaving(personal1);
                const personalSaving2 = DB.addPersonalSaving(personal2);
                const personalSaving3 = DB.addPersonalSaving(personal3);
                
                // Sample group savings
                const group1 = {
                    name: "Pernikahan Andi",
                    category: "acara",
                    targetAmount: 20000000,
                    deadline: "2024-11-15",
                    members: ["andi@example.com", "budi@example.com", "cindy@example.com", "dewi@example.com"],
                    notes: "Kado pernikahan untuk Andi",
                    privacy: false,
                    iconName: "glass-cheers",
                    iconColor: "purple"
                };
                
                const group2 = {
                    name: "Liburan Bersama",
                    category: "liburan",
                    targetAmount: 20000000,
                    deadline: "2025-01-01",
                    members: ["andi@example.com", "budi@example.com", "cindy@example.com"],
                    notes: "Liburan ke Bali bersama teman",
                    privacy: false,
                    iconName: "umbrella-beach",
                    iconColor: "blue"
                };
                
                const groupSaving1 = DB.addGroupSaving(group1);
                const groupSaving2 = DB.addGroupSaving(group2);
                
                // Sample transactions
                const twoMonthsAgo = new Date();
                twoMonthsAgo.setMonth(twoMonthsAgo.getMonth() - 2);
                
                const oneMonthAgo = new Date();
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                
                const threeDaysAgo = new Date();
                threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);
                
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                const today = new Date();
                
                // Transactions for personal savings
                const transaction1 = {
                    savingId: personalSaving1.id,
                    amount: 2000000,
                    date: oneMonthAgo.toISOString().split('T')[0],
                    paymentMethod: "bank",
                    notes: "Setoran awal",
                    type: "deposit"
                };
                
                const transaction2 = {
                    savingId: personalSaving1.id,
                    amount: 1000000,
                    date: weekAgo.toISOString().split('T')[0],
                    paymentMethod: "bank",
                    notes: "",
                    type: "deposit"
                };
                
                const transaction3 = {
                    savingId: personalSaving1.id,
                    amount: 500000,
                    date: today.toISOString().split('T')[0],
                    paymentMethod: "e-wallet",
                    notes: "",
                    type: "deposit"
                };
                
                const transaction4 = {
                    savingId: personalSaving2.id,
                    amount: 5000000,
                    date: twoMonthsAgo.toISOString().split('T')[0],
                    paymentMethod: "bank",
                    notes: "Setoran awal",
                    type: "deposit"
                };
                
                const transaction5 = {
                    savingId: personalSaving2.id,
                    amount: 1000000,
                    date: weekAgo.toISOString().split('T')[0],
                    paymentMethod: "bank",
                    notes: "",
                    type: "deposit"
                };
                
                const transaction6 = {
                    savingId: personalSaving3.id,
                    amount: 2000000,
                    date: oneMonthAgo.toISOString().split('T')[0],
                    paymentMethod: "bank",
                    notes: "Setoran awal",
                    type: "deposit"
                };
                
                const transaction7 = {
                    savingId: personalSaving3.id,
                    amount: 300000,
                    date: threeDaysAgo.toISOString().split('T')[0],
                    paymentMethod: "cash",
                    notes: "Keperluan berobat",
                    type: "withdraw"
                };
                
                // Transactions for group savings
                const transaction8 = {
                    savingId: groupSaving1.id,
                    amount: 5000000,
                    date: twoMonthsAgo.toISOString().split('T')[0],
                    paymentMethod: "bank",
                    notes: "Kontribusi awal",
                    type: "deposit"
                };
                
                const transaction9 = {
                    savingId: groupSaving1.id,
                    amount: 500000,
                    date: yesterday.toISOString().split('T')[0],
                    paymentMethod: "e-wallet",
                    notes: "Kontribusi dari Rendi",
                    type: "deposit"
                };
                
                const transaction10 = {
                    savingId: groupSaving2.id,
                    amount: 5000000,
                    date: oneMonthAgo.toISOString().split('T')[0],
                    paymentMethod: "bank",
                    notes: "Setoran awal",
                    type: "deposit"
                };
                
                DB.addTransaction(transaction1);
                DB.addTransaction(transaction2);
                DB.addTransaction(transaction3);
                DB.addTransaction(transaction4);
                DB.addTransaction(transaction5);
                DB.addTransaction(transaction6);
                DB.addTransaction(transaction7);
                DB.addTransaction(transaction8);
                DB.addTransaction(transaction9);
                DB.addTransaction(transaction10);
                
                // Add notifications
                DB.addNotification({
                    type: "success",
                    title: "Selamat Datang",
                    message: "Selamat datang di aplikasi TabunganKu! Mulai atur keuangan Anda dengan mudah.",
                    timestamp: new Date().toISOString()
                });
                
                // Update UI
                loadPersonalSavings();
                loadGroupSavings();
                loadTransactions();
                updateDashboard();
                loadNotifications();
            }
            
            // Check for dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });

            // Initialize chart
            const ctx = document.getElementById('savingsChart').getContext('2d');
            let savingsChart;
            
            function initializeChart(period = 'monthly') {
                // Get chart mode (light/dark) for colors
                const isDarkMode = document.documentElement.classList.contains('dark');
                const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDarkMode ? '#9ca3af' : '#6b7280';
                
                if (savingsChart) {
                    savingsChart.destroy();
                }
                
                // Generate chart data based on actual transactions
                const chartData = generateChartData(period);
                
                savingsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: chartData.labels,
                        datasets: [
                            {
                                label: 'Tabungan Pribadi',
                                data: chartData.personalData,
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Tabungan Bersama',
                                data: chartData.groupData,
                                borderColor: '#5D5CDE',
                                backgroundColor: 'rgba(93, 92, 222, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    color: textColor
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += new Intl.NumberFormat('id-ID', { 
                                                style: 'currency', 
                                                currency: 'IDR',
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            }).format(context.parsed.y);
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            },
                            y: {
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor,
                                    callback: function(value) {
                                        return new Intl.NumberFormat('id-ID', { 
                                            style: 'currency', 
                                            currency: 'IDR',
                                            minimumFractionDigits: 0,
                                            maximumFractionDigits: 0
                                        }).format(value);
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            function generateChartData(period) {
                const now = new Date();
                let labels = [];
                let personalData = [];
                let groupData = [];
                
                // Get all transactions
                const allTransactions = DB.getTransactions();
                
                switch (period) {
                    case 'daily':
                        // Labels for today in 3-hour intervals
                        for (let hour = 0; hour < 24; hour += 3) {
                            const timeLabel = `${hour.toString().padStart(2, '0')}:00`;
                            labels.push(timeLabel);
                        }
                        
                        // Process transactions for today
                        const todayStart = new Date(now);
                        todayStart.setHours(0, 0, 0, 0);
                        
                        const todayTrans = allTransactions.filter(t => new Date(t.timestamp) >= todayStart);
                        
                        // Calculate balances at each interval
                        let personalBalance = DB.getPersonalTotalBalance();
                        let groupBalance = DB.getGroupTotalBalance();
                        
                        // Remove today's transactions from the balances to get starting balance
                        todayTrans.forEach(t => {
                            const isSavingPersonal = DB.getPersonalSavingById(t.savingId) !== null;
                            
                            if (isSavingPersonal) {
                                if (t.type === 'deposit') {
                                    personalBalance -= parseInt(t.amount);
                                } else {
                                    personalBalance += parseInt(t.amount);
                                }
                            } else {
                                if (t.type === 'deposit') {
                                    groupBalance -= parseInt(t.amount);
                                } else {
                                    groupBalance += parseInt(t.amount);
                                }
                            }
                        });
                        
                        // Create the hourly data points
                        for (let hour = 0; hour < 24; hour += 3) {
                            const hourEnd = new Date(todayStart);
                            hourEnd.setHours(hour + 3, 0, 0, 0);
                            
                            // Add transactions that occurred before this hour
                            const hourTrans = todayTrans.filter(t => 
                                new Date(t.timestamp) < hourEnd
                            );
                            
                            let hourlyPersonalBalance = personalBalance;
                            let hourlyGroupBalance = groupBalance;
                            
                            hourTrans.forEach(t => {
                                const isSavingPersonal = DB.getPersonalSavingById(t.savingId) !== null;
                                
                                if (isSavingPersonal) {
                                    if (t.type === 'deposit') {
                                        hourlyPersonalBalance += parseInt(t.amount);
                                    } else {
                                        hourlyPersonalBalance -= parseInt(t.amount);
                                    }
                                } else {
                                    if (t.type === 'deposit') {
                                        hourlyGroupBalance += parseInt(t.amount);
                                    } else {
                                        hourlyGroupBalance -= parseInt(t.amount);
                                    }
                                }
                            });
                            
                            personalData.push(hourlyPersonalBalance);
                            groupData.push(hourlyGroupBalance);
                            
                            // If we're past the current hour, stop adding more transactions
                            if (hourEnd > now) break;
                        }
                        
                        // Fill in future hours with current balance
                        while (personalData.length < labels.length) {
                            personalData.push(personalData[personalData.length - 1]);
                            groupData.push(groupData[groupData.length - 1]);
                        }
                        break;
                        
                    case 'monthly':
                        // For the current month, show weekly data
                        const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
                        const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                        
                        // Generate weekly labels
                        const daysInMonth = lastDay.getDate();
                        const weeksInMonth = Math.ceil(daysInMonth / 7);
                        
                        for (let week = 0; week < weeksInMonth; week++) {
                            const startDate = new Date(firstDay);
                            startDate.setDate(firstDay.getDate() + week * 7);
                            
                            if (startDate > now) break; // Don't show future weeks
                            
                            const weekLabel = `${startDate.getDate()} ${startDate.toLocaleString('id-ID', { month: 'short' })}`;
                            labels.push(weekLabel);
                        }
                        
                        // Calculate balances for each week
                        let monthlyPersonalBalance = DB.getPersonalTotalBalance();
                        let monthlyGroupBalance = DB.getGroupTotalBalance();
                        
                        // Get transactions for this month
                        const monthTrans = allTransactions.filter(t => 
                            new Date(t.timestamp) >= firstDay && new Date(t.timestamp) <= now
                        );
                        
                        // Remove this month's transactions to get starting balance
                        monthTrans.forEach(t => {
                            const isSavingPersonal = DB.getPersonalSavingById(t.savingId) !== null;
                            
                            if (isSavingPersonal) {
                                if (t.type === 'deposit') {
                                    monthlyPersonalBalance -= parseInt(t.amount);
                                } else {
                                    monthlyPersonalBalance += parseInt(t.amount);
                                }
                            } else {
                                if (t.type === 'deposit') {
                                    monthlyGroupBalance -= parseInt(t.amount);
                                } else {
                                    monthlyGroupBalance += parseInt(t.amount);
                                }
                            }
                        });
                        
                        // Add weekly balances
                        for (let week = 0; week < labels.length; week++) {
                            const weekEnd = new Date(firstDay);
                            weekEnd.setDate(firstDay.getDate() + (week + 1) * 7 - 1);
                            
                            if (weekEnd > now) weekEnd.setTime(now.getTime());
                            
                            const weekTrans = monthTrans.filter(t => 
                                new Date(t.timestamp) <= weekEnd
                            );
                            
                            let weeklyPersonalBalance = monthlyPersonalBalance;
                            let weeklyGroupBalance = monthlyGroupBalance;
                            
                            weekTrans.forEach(t => {
                                const isSavingPersonal = DB.getPersonalSavingById(t.savingId) !== null;
                                
                                if (isSavingPersonal) {
                                    if (t.type === 'deposit') {
                                        weeklyPersonalBalance += parseInt(t.amount);
                                    } else {
                                        weeklyPersonalBalance -= parseInt(t.amount);
                                    }
                                } else {
                                    if (t.type === 'deposit') {
                                        weeklyGroupBalance += parseInt(t.amount);
                                    } else {
                                        weeklyGroupBalance -= parseInt(t.amount);
                                    }
                                }
                            });
                            
                            personalData.push(weeklyPersonalBalance);
                            groupData.push(weeklyGroupBalance);
                        }
                        break;
                        
                    case 'yearly':
                        // For the current year, show monthly data
                        for (let month = 0; month < 12; month++) {
                            const monthDate = new Date(now.getFullYear(), month, 1);
                            
                            if (monthDate > now) break; // Don't show future months
                            
                            const monthLabel = monthDate.toLocaleString('id-ID', { month: 'short' });
                            labels.push(monthLabel);
                        }
                        
                        // Calculate balances for each month
                        let yearlyPersonalBalance = DB.getPersonalTotalBalance();
                        let yearlyGroupBalance = DB.getGroupTotalBalance();
                        
                        // Get transactions for this year
                        const yearStart = new Date(now.getFullYear(), 0, 1);
                        const yearTrans = allTransactions.filter(t => 
                            new Date(t.timestamp) >= yearStart && new Date(t.timestamp) <= now
                        );
                        
                        // Remove this year's transactions to get starting balance
                        yearTrans.forEach(t => {
                            const isSavingPersonal = DB.getPersonalSavingById(t.savingId) !== null;
                            
                            if (isSavingPersonal) {
                                if (t.type === 'deposit') {
                                    yearlyPersonalBalance -= parseInt(t.amount);
                                } else {
                                    yearlyPersonalBalance += parseInt(t.amount);
                                }
                            } else {
                                if (t.type === 'deposit') {
                                    yearlyGroupBalance -= parseInt(t.amount);
                                } else {
                                    yearlyGroupBalance += parseInt(t.amount);
                                }
                            }
                        });
                        
                        // Add monthly balances
                        for (let month = 0; month < labels.length; month++) {
                            const monthEnd = new Date(now.getFullYear(), month + 1, 0);
                            
                            if (monthEnd > now) monthEnd.setTime(now.getTime());
                            
                            const monthTrans = yearTrans.filter(t => 
                                new Date(t.timestamp) <= monthEnd
                            );
                            
                            let monthlyPersonalBalance = yearlyPersonalBalance;
                            let monthlyGroupBalance = yearlyGroupBalance;
                            
                            monthTrans.forEach(t => {
                                const isSavingPersonal = DB.getPersonalSavingById(t.savingId) !== null;
                                
                                if (isSavingPersonal) {
                                    if (t.type === 'deposit') {
                                        monthlyPersonalBalance += parseInt(t.amount);
                                    } else {
                                        monthlyPersonalBalance -= parseInt(t.amount);
                                    }
                                } else {
                                    if (t.type === 'deposit') {
                                        monthlyGroupBalance += parseInt(t.amount);
                                    } else {
                                        monthlyGroupBalance -= parseInt(t.amount);
                                    }
                                }
                            });
                            
                            personalData.push(monthlyPersonalBalance);
                            groupData.push(monthlyGroupBalance);
                        }
                        break;
                }
                
                return {
                    labels: labels,
                    personalData: personalData,
                    groupData: groupData
                };
            }
            
            // Load and render personal savings
            function loadPersonalSavings() {
                const personalSavings = DB.getPersonalSavings();
                const container = document.getElementById('personal-savings-container');
                const addNewCard = document.getElementById('add-personal-card');
                const emptyState = document.getElementById('personal-empty-state');
                
                // Clear previous cards but keep the add new card
                const personalSavingCards = container.querySelectorAll('.personal-saving-card');
                personalSavingCards.forEach(card => card.remove());
                
                // Show empty state if no savings
                if (personalSavings.length === 0) {
                    emptyState.classList.remove('hidden');
                    container.classList.add('hidden');
                } else {
                    emptyState.classList.add('hidden');
                    container.classList.remove('hidden');
                    
                    // Add personal saving cards
                    personalSavings.forEach(saving => {
                        const card = createPersonalSavingCard(saving);
                        container.insertBefore(card, addNewCard);
                    });
                }
                
                // Also update transaction saving dropdown
                updateTransactionSavingDropdown();
            }
            
            // Create a personal saving card
            function createPersonalSavingCard(saving) {
                const progress = calculateProgress(saving.balance, saving.targetAmount);
                const colorMap = {
                    'liburan': 'blue',
                    'pendidikan': 'green',
                    'kendaraan': 'yellow',
                    'elektronik': 'purple',
                    'rumah': 'indigo',
                    'darurat': 'red',
                    'lainnya': 'gray'
                };
                const color = colorMap[saving.category] || 'blue';
                
                const card = document.createElement('div');
                card.className = `personal-saving-card bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden`;
                card.setAttribute('data-id', saving.id);
                
                card.innerHTML = `
                    <div class="h-3 bg-${color}-500"></div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="flex items-center">
                                    <h3 class="font-semibold text-lg">${saving.name}</h3>
                                    <span class="ml-2 px-2 py-0.5 text-xs rounded-full bg-${color}-100 dark:bg-${color}-900/30 text-${color}-800 dark:text-${color}-300">${getCategoryLabel(saving.category)}</span>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">${saving.deadline ? 'Target: ' + DB.formatDate(saving.deadline) : 'Ongoing'}</p>
                            </div>
                            <div class="dropdown relative">
                                <button class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 personal-saving-menu" data-id="${saving.id}">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="personal-saving-dropdown hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-10">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 edit-personal-saving" data-id="${saving.id}">
                                        <i class="fas fa-edit mr-2"></i> Edit
                                    </a>
                                    <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700 delete-personal-saving" data-id="${saving.id}">
                                        <i class="fas fa-trash mr-2"></i> Hapus
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="flex justify-between mb-1 text-sm">
                                <span>Progress</span>
                                <span>${progress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                <div class="bg-${color}-500 h-2.5 rounded-full" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Terkumpul</p>
                                <p class="font-semibold">${DB.formatCurrency(saving.balance)}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Target</p>
                                <p class="font-semibold">${DB.formatCurrency(saving.targetAmount)}</p>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-between">
                            <button class="text-accent-500 font-medium text-sm hover:text-accent-600 deposit-btn" data-id="${saving.id}" data-name="${saving.name}">
                                <i class="fas fa-plus mr-1"></i> Tambah Setoran
                            </button>
                            <button class="text-gray-500 font-medium text-sm hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300 withdraw-btn" data-id="${saving.id}" data-name="${saving.name}">
                                <i class="fas fa-minus mr-1"></i> Penarikan
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                setTimeout(() => {
                    const menu = card.querySelector('.personal-saving-menu');
                    const dropdown = card.querySelector('.personal-saving-dropdown');
                    const editBtn = card.querySelector('.edit-personal-saving');
                    const deleteBtn = card.querySelector('.delete-personal-saving');
                    const depositBtn = card.querySelector('.deposit-btn');
                    const withdrawBtn = card.querySelector('.withdraw-btn');
                    
                    menu.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        dropdown.classList.toggle('hidden');
                        
                        // Close other dropdowns
                        document.querySelectorAll('.personal-saving-dropdown').forEach(d => {
                            if (d !== dropdown) {
                                d.classList.add('hidden');
                            }
                        });
                    });
                    
                    editBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        editPersonalSaving(saving.id);
                        dropdown.classList.add('hidden');
                    });
                    
                    deleteBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        confirmDeleteItem(saving.id, 'personal');
                        dropdown.classList.add('hidden');
                    });
                    
                    depositBtn.addEventListener('click', () => {
                        openTransactionModal('deposit', saving.id);
                    });
                    
                    withdrawBtn.addEventListener('click', () => {
                        openTransactionModal('withdraw', saving.id);
                    });
                    
                    // Close dropdown when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!menu.contains(e.target) && !dropdown.contains(e.target)) {
                            dropdown.classList.add('hidden');
                        }
                    });
                }, 0);
                
                return card;
            }
            
            // Load and render group savings
            function loadGroupSavings() {
                const groupSavings = DB.getGroupSavings();
                const container = document.getElementById('group-savings-container');
                const addNewCard = document.getElementById('add-group-card');
                const emptyState = document.getElementById('group-empty-state');
                
                // Clear previous cards but keep the add new card
                const groupSavingCards = container.querySelectorAll('.group-saving-card');
                groupSavingCards.forEach(card => card.remove());
                
                // Show empty state if no savings
                if (groupSavings.length === 0) {
                    emptyState.classList.remove('hidden');
                    container.classList.add('hidden');
                } else {
                    emptyState.classList.add('hidden');
                    container.classList.remove('hidden');
                    
                    // Add group saving cards
                    groupSavings.forEach(saving => {
                        const card = createGroupSavingCard(saving);
                        container.insertBefore(card, addNewCard);
                    });
                }
                
                // Also update transaction saving dropdown
                updateTransactionSavingDropdown();
            }
            
            // Create a group saving card
            function createGroupSavingCard(saving) {
                const progress = calculateProgress(saving.balance, saving.targetAmount);
                const colorMap = {
                    'liburan': 'blue',
                    'acara': 'purple',
                    'hadiah': 'pink',
                    'arisan': 'green',
                    'donasi': 'yellow',
                    'lainnya': 'gray'
                };
                const color = colorMap[saving.category] || 'purple';
                const iconName = saving.iconName || (saving.category === 'liburan' ? 'umbrella-beach' : 'glass-cheers');
                
                const card = document.createElement('div');
                card.className = `group-saving-card bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden`;
                card.setAttribute('data-id', saving.id);
                
                card.innerHTML = `
                    <div class="p-6">
                        <div class="flex items-start">
                            <div class="h-12 w-12 rounded-full bg-${color}-100 dark:bg-${color}-900/30 flex items-center justify-center text-${color}-500 mr-4 flex-shrink-0">
                                <i class="fas fa-${iconName}"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-semibold text-lg">${saving.name}</h3>
                                        <div class="flex items-center mt-1 space-x-2">
                                            <span class="px-2 py-0.5 text-xs rounded-full bg-${color}-100 dark:bg-${color}-900/30 text-${color}-800 dark:text-${color}-300">${getCategoryLabel(saving.category)}</span>
                                            <span class="text-sm text-gray-500 dark:text-gray-400">${saving.members?.length || 0} Anggota</span>
                                        </div>
                                    </div>
                                    <div class="dropdown relative">
                                        <button class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 group-saving-menu" data-id="${saving.id}">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div class="group-saving-dropdown hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-10">
                                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 edit-group-saving" data-id="${saving.id}">
                                                <i class="fas fa-edit mr-2"></i> Edit
                                            </a>
                                            <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700 delete-group-saving" data-id="${saving.id}">
                                                <i class="fas fa-trash mr-2"></i> Hapus
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">${saving.deadline ? 'Target: ' + DB.formatDate(saving.deadline) : 'Ongoing'}</p>
                            </div>
                        </div>
                        
                        <div class="mt-5 mb-4">
                            <div class="flex justify-between mb-1 text-sm">
                                <span>Progress</span>
                                <span>${progress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                <div class="bg-${color}-500 h-2.5 rounded-full" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Terkumpul</p>
                                <p class="font-semibold">${DB.formatCurrency(saving.balance)}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500 dark:text-gray-400">Target</p>
                                <p class="font-semibold">${DB.formatCurrency(saving.targetAmount)}</p>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex space-x-3">
                            <button class="text-accent-500 font-medium text-sm hover:text-accent-600 flex-grow py-2 border border-accent-500 rounded-md deposit-btn" data-id="${saving.id}" data-name="${saving.name}">
                                <i class="fas fa-plus mr-1"></i> Tambah Setoran
                            </button>
                            <button class="text-white font-medium text-sm bg-accent-500 hover:bg-accent-600 flex-grow py-2 rounded-md">
                                <i class="fas fa-comments mr-1"></i> Chat Grup
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners
                setTimeout(() => {
                    const menu = card.querySelector('.group-saving-menu');
                    const dropdown = card.querySelector('.group-saving-dropdown');
                    const editBtn = card.querySelector('.edit-group-saving');
                    const deleteBtn = card.querySelector('.delete-group-saving');
                    const depositBtn = card.querySelector('.deposit-btn');
                    
                    menu.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        dropdown.classList.toggle('hidden');
                        
                        // Close other dropdowns
                        document.querySelectorAll('.group-saving-dropdown').forEach(d => {
                            if (d !== dropdown) {
                                d.classList.add('hidden');
                            }
                        });
                    });
                    
                    editBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        editGroupSaving(saving.id);
                        dropdown.classList.add('hidden');
                    });
                    
                    deleteBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        confirmDeleteItem(saving.id, 'group');
                        dropdown.classList.add('hidden');
                    });
                    
                    depositBtn.addEventListener('click', () => {
                        openTransactionModal('deposit', saving.id);
                    });
                    
                    // Close dropdown when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!menu.contains(e.target) && !dropdown.contains(e.target)) {
                            dropdown.classList.add('hidden');
                        }
                    });
                }, 0);
                
                return card;
            }
            
            // Calculate progress percentage
            function calculateProgress(current, target) {
                if (!target || target <= 0) return 0;
                const progress = (current / target) * 100;
                return Math.min(Math.round(progress), 100);
            }
            
            // Get category label based on category value
            function getCategoryLabel(category) {
                const categoryMap = {
                    'liburan': 'Liburan',
                    'pendidikan': 'Pendidikan',
                    'kendaraan': 'Kendaraan',
                    'elektronik': 'Elektronik',
                    'rumah': 'Rumah',
                    'darurat': 'Darurat',
                    'acara': 'Acara',
                    'hadiah': 'Hadiah',
                    'arisan': 'Arisan',
                    'donasi': 'Donasi',
                    'lainnya': 'Lainnya'
                };
                
                return categoryMap[category] || 'Lainnya';
            }
            
            // Form handling for personal savings
            const personalSavingForm = document.getElementById('personal-saving-form');
            const personalSavingModal = document.getElementById('add-personal-saving-modal');
            const personalSavingModalTitle = document.getElementById('personal-saving-modal-title');
            const deletePersonalSavingBtn = document.getElementById('delete-personal-saving-btn');
            
            personalSavingForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const savingId = document.getElementById('personal-saving-id').value;
                const name = document.getElementById('saving-name').value;
                const category = document.getElementById('saving-category').value;
                const targetAmount = parseInt(document.getElementById('saving-target').value);
                const deadline = document.getElementById('saving-deadline').value;
                const initialAmount = parseInt(document.getElementById('saving-init').value || 0);
                const notes = document.getElementById('saving-notes').value;
                
                const saving = {
                    id: savingId, // Will be ignored or used by update
                    name,
                    category,
                    targetAmount,
                    deadline,
                    initialAmount,
                    notes
                };
                
                let result;
                let message;
                
                if (savingId) {
                    // Update existing saving
                    result = DB.updatePersonalSaving(savingId, saving);
                    message = 'Tabungan pribadi berhasil diperbarui!';
                } else {
                    // Add new saving
                    result = DB.addPersonalSaving(saving);
                    message = 'Tabungan pribadi berhasil dibuat!';
                    
                    // Add initial deposit if amount > 0
                    if (initialAmount > 0) {
                        DB.addTransaction({
                            savingId: result.id,
                            amount: initialAmount,
                            date: new Date().toISOString().split('T')[0],
                            paymentMethod: 'bank',
                            notes: 'Setoran awal',
                            type: 'deposit'
                        });
                    }
                }
                
                if (result) {
                    personalSavingModal.classList.add('hidden');
                    loadPersonalSavings();
                    updateDashboard();
                    loadRecentActivities();
                    showNotification(message, 'success');
                    
                    // Show badge if it's a new saving
                    if (!savingId) {
                        setTimeout(() => {
                            if (DB.getPersonalSavings().length === 1) {
                                showBadgeAchievement('fa-piggy-bank', 'First Saver', 'Membuat tabungan pertama');
                            }
                        }, 1000);
                    }
                }
            });
            
            // Form handling for group savings
            const groupSavingForm = document.getElementById('group-saving-form');
            const groupSavingModal = document.getElementById('add-group-saving-modal');
            const groupSavingModalTitle = document.getElementById('group-saving-modal-title');
            const deleteGroupSavingBtn = document.getElementById('delete-group-saving-btn');
            
            groupSavingForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const savingId = document.getElementById('group-saving-id').value;
                const name = document.getElementById('group-name').value;
                const category = document.getElementById('group-category').value;
                const targetAmount = parseInt(document.getElementById('group-target').value);
                const deadline = document.getElementById('group-deadline').value;
                const privacy = document.getElementById('group-privacy').checked;
                
                // Collect members from the list
                const membersList = document.getElementById('members-list');
                const memberItems = membersList.querySelectorAll('.member-item');
                const members = [];
                
                memberItems.forEach(item => {
                    const email = item.getAttribute('data-email');
                    if (email) {
                        members.push(email);
                    }
                });
                
                const saving = {
                    id: savingId, // Will be ignored or used by update
                    name,
                    category,
                    targetAmount,
                    deadline,
                    members,
                    privacy,
                    iconName: category === 'liburan' ? 'umbrella-beach' : 'glass-cheers'
                };
                
                let result;
                let message;
                
                if (savingId) {
                    // Update existing saving
                    result = DB.updateGroupSaving(savingId, saving);
                    message = 'Grup tabungan berhasil diperbarui!';
                } else {
                    // Add new saving
                    result = DB.addGroupSaving(saving);
                    message = 'Grup tabungan berhasil dibuat!';
                }
                
                if (result) {
                    groupSavingModal.classList.add('hidden');
                    loadGroupSavings();
                    updateDashboard();
                    showNotification(message, 'success');
                    
                    // Show badge if it's a new group saving
                    if (!savingId && DB.getGroupSavings().length === 1) {
                        setTimeout(() => {
                            showBadgeAchievement('fa-users', 'Team Player', 'Membuat grup tabungan pertama');
                        }, 1000);
                    }
                }
            });
            
            // Transaction form handling
            const transactionForm = document.getElementById('transaction-form');
            const transactionModal = document.getElementById('transaction-modal');
            const transactionModalTitle = document.getElementById('transaction-modal-title');
            const transactionType = document.getElementById('transaction-type');
            const transactionAmountLabel = document.getElementById('transaction-amount-label');
            const deleteTransactionBtn = document.getElementById('delete-transaction-btn');
            
            // Set current date for transaction date input
            document.getElementById('transaction-date').valueAsDate = new Date();
            
            transactionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const transactionId = document.getElementById('transaction-id').value;
                const type = transactionType.value;
                const savingId = document.getElementById('transaction-saving').value;
                const amount = parseInt(document.getElementById('transaction-amount').value);
                const date = document.getElementById('transaction-date').value;
                const paymentMethod = document.getElementById('transaction-payment-method').value;
                const notes = document.getElementById('transaction-notes').value;
                
                const transaction = {
                    id: transactionId,
                    type,
                    savingId,
                    amount,
                    date,
                    paymentMethod,
                    notes
                };
                
                let result;
                let message;
                
                if (transactionId) {
                    // Update existing transaction
                    result = DB.updateTransaction(transactionId, transaction);
                    message = type === 'deposit' ? 'Setoran berhasil diperbarui!' : 'Penarikan berhasil diperbarui!';
                } else {
                    // Add new transaction
                    result = DB.addTransaction(transaction);
                    message = type === 'deposit' ? 'Setoran berhasil ditambahkan!' : 'Penarikan berhasil ditambahkan!';
                }
                
                if (result) {
                    transactionModal.classList.add('hidden');
                    loadPersonalSavings();
                    loadGroupSavings();
                    loadTransactions();
                    updateDashboard();
                    loadRecentActivities();
                    showNotification(message, 'success');
                    
                    // Show badge for consistent saver after deposit
                    if (type === 'deposit' && !transactionId) {
                        setTimeout(() => {
                            showBadgeAchievement('fa-award', 'Penabung Konsisten', 'Menabung secara rutin');
                        }, 1500);
                    }
                }
            });
            
            // Transaction detail modal
            const transactionDetailModal = document.getElementById('transaction-detail-modal');
            const transactionDetailClose = document.getElementById('transaction-detail-close');
            const editTransactionBtn = document.getElementById('edit-transaction-btn');
            const viewDetailDeleteTransactionBtn = document.getElementById('view-detail-delete-transaction-btn');
            
            function openTransactionDetailModal(transactionId) {
                const transaction = DB.getTransactionById(transactionId);
                if (!transaction) return;
                
                // Set modal content
                const typeEl = document.getElementById('transaction-detail-type');
                const amountEl = document.getElementById('transaction-detail-amount');
                const dateEl = document.getElementById('transaction-detail-date');
                const savingEl = document.getElementById('transaction-detail-saving');
                const methodEl = document.getElementById('transaction-detail-method');
                const notesEl = document.getElementById('transaction-detail-notes');
                
                // Type badge
                typeEl.innerHTML = '';
                typeEl.className = transaction.type === 'deposit' 
                    ? 'flex justify-center py-2 px-4 rounded-lg bg-green-500 text-white font-medium mb-2' 
                    : 'flex justify-center py-2 px-4 rounded-lg bg-red-500 text-white font-medium mb-2';
                typeEl.innerHTML = `
                    <i class="fas fa-${transaction.type === 'deposit' ? 'arrow-up' : 'arrow-down'} mr-2"></i>
                    ${transaction.type === 'deposit' ? 'Setoran' : 'Penarikan'}
                `;
                
                // Amount, date, saving, method, notes
                amountEl.textContent = DB.formatCurrency(transaction.amount);
                dateEl.textContent = DB.formatDate(transaction.date);
                savingEl.textContent = DB.getSavingNameById(transaction.savingId);
                
                const methodLabels = {
                    'bank': 'Transfer Bank',
                    'e-wallet': 'E-Wallet',
                    'credit-card': 'Kartu Kredit',
                    'cash': 'Tunai'
                };
                methodEl.textContent = methodLabels[transaction.paymentMethod] || transaction.paymentMethod;
                
                notesEl.textContent = transaction.notes || '-';
                
                // Set button actions
                editTransactionBtn.setAttribute('data-id', transaction.id);
                viewDetailDeleteTransactionBtn.setAttribute('data-id', transaction.id);
                
                transactionDetailModal.classList.remove('hidden');
            }
            
            transactionDetailClose.addEventListener('click', () => {
                transactionDetailModal.classList.add('hidden');
            });
            
            editTransactionBtn.addEventListener('click', () => {
                const transactionId = editTransactionBtn.getAttribute('data-id');
                editTransaction(transactionId);
                transactionDetailModal.classList.add('hidden');
            });
            
            viewDetailDeleteTransactionBtn.addEventListener('click', () => {
                const transactionId = viewDetailDeleteTransactionBtn.getAttribute('data-id');
                confirmDeleteItem(transactionId, 'transaction');
                transactionDetailModal.classList.add('hidden');
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === transactionDetailModal) {
                    transactionDetailModal.classList.add('hidden');
                }
            });
            
            // Delete confirmation modal
            const deleteConfirmModal = document.getElementById('delete-confirm-modal');
            const deleteConfirmTitle = document.getElementById('delete-confirm-title');
            const deleteConfirmMessage = document.getElementById('delete-confirm-message');
            const deleteItemId = document.getElementById('delete-item-id');
            const deleteItemType = document.getElementById('delete-item-type');
            const deleteConfirmBtn = document.getElementById('delete-confirm-btn');
            const deleteCancelBtn = document.getElementById('delete-cancel-btn');
            
            function confirmDeleteItem(id, type) {
                deleteItemId.value = id;
                deleteItemType.value = type;
                
                // Set title and message based on type
                switch (type) {
                    case 'personal':
                        const personal = DB.getPersonalSavingById(id);
                        deleteConfirmTitle.textContent = 'Hapus Tabungan Pribadi';
                        deleteConfirmMessage.textContent = `Apakah Anda yakin ingin menghapus tabungan "${personal.name}"? Semua transaksi terkait juga akan dihapus.`;
                        break;
                    case 'group':
                        const group = DB.getGroupSavingById(id);
                        deleteConfirmTitle.textContent = 'Hapus Grup Tabungan';
                        deleteConfirmMessage.textContent = `Apakah Anda yakin ingin menghapus grup "${group.name}"? Semua transaksi terkait juga akan dihapus.`;
                        break;
                    case 'transaction':
                        const transaction = DB.getTransactionById(id);
                        const savingName = DB.getSavingNameById(transaction.savingId);
                        const transactionType = transaction.type === 'deposit' ? 'setoran' : 'penarikan';
                        deleteConfirmTitle.textContent = `Hapus ${transactionType.charAt(0).toUpperCase() + transactionType.slice(1)}`;
                        deleteConfirmMessage.textContent = `Apakah Anda yakin ingin menghapus ${transactionType} ${DB.formatCurrency(transaction.amount)} dari "${savingName}"?`;
                        break;
                }
                
                deleteConfirmModal.classList.remove('hidden');
            }
            
            deleteConfirmBtn.addEventListener('click', () => {
                const id = deleteItemId.value;
                const type = deleteItemType.value;
                
                let success = false;
                let message = '';
                
                switch (type) {
                    case 'personal':
                        success = DB.deletePersonalSaving(id);
                        message = 'Tabungan pribadi berhasil dihapus!';
                        if (success) {
                            loadPersonalSavings();
                            loadTransactions();
                            updateDashboard();
                            loadRecentActivities();
                        }
                        break;
                    case 'group':
                        success = DB.deleteGroupSaving(id);
                        message = 'Grup tabungan berhasil dihapus!';
                        if (success) {
                            loadGroupSavings();
                            loadTransactions();
                            updateDashboard();
                            loadRecentActivities();
                        }
                        break;
                    case 'transaction':
                        success = DB.deleteTransaction(id);
                        message = 'Transaksi berhasil dihapus!';
                        if (success) {
                            loadPersonalSavings();
                            loadGroupSavings();
                            loadTransactions();
                            updateDashboard();
                            loadRecentActivities();
                        }
                        break;
                }
                
                if (success) {
                    showNotification(message, 'success');
                }
                
                deleteConfirmModal.classList.add('hidden');
            });
            
            deleteCancelBtn.addEventListener('click', () => {
                deleteConfirmModal.classList.add('hidden');
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === deleteConfirmModal) {
                    deleteConfirmModal.classList.add('hidden');
                }
            });
            
            // Edit personal saving
            function editPersonalSaving(id) {
                const saving = DB.getPersonalSavingById(id);
                if (!saving) return;
                
                // Set form values
                document.getElementById('personal-saving-id').value = saving.id;
                document.getElementById('saving-name').value = saving.name;
                document.getElementById('saving-category').value = saving.category;
                document.getElementById('saving-target').value = saving.targetAmount;
                document.getElementById('saving-deadline').value = saving.deadline || '';
                document.getElementById('saving-init').value = saving.initialAmount || '';
                document.getElementById('saving-notes').value = saving.notes || '';
                
                // Update modal title and show delete button
                personalSavingModalTitle.textContent = 'Edit Tabungan Pribadi';
                deletePersonalSavingBtn.classList.remove('hidden');
                
                // Show modal
                personalSavingModal.classList.remove('hidden');
                
                // Set delete button action
                deletePersonalSavingBtn.onclick = () => {
                    personalSavingModal.classList.add('hidden');
                    confirmDeleteItem(id, 'personal');
                };
            }
            
            // Edit group saving
            function editGroupSaving(id) {
                const saving = DB.getGroupSavingById(id);
                if (!saving) return;
                
                // Set form values
                document.getElementById('group-saving-id').value = saving.id;
                document.getElementById('group-name').value = saving.name;
                document.getElementById('group-category').value = saving.category;
                document.getElementById('group-target').value = saving.targetAmount;
                document.getElementById('group-deadline').value = saving.deadline || '';
                document.getElementById('group-privacy').checked = saving.privacy || false;
                
                // Clear and repopulate members list
                const membersList = document.getElementById('members-list');
                membersList.innerHTML = '';
                
                if (saving.members && saving.members.length > 0) {
                    saving.members.forEach(email => {
                        addMemberToList(email);
                    });
                }
                
                // Update modal title and show delete button
                groupSavingModalTitle.textContent = 'Edit Grup Tabungan';
                deleteGroupSavingBtn.classList.remove('hidden');
                
                // Show modal
                groupSavingModal.classList.remove('hidden');
                
                // Set delete button action
                deleteGroupSavingBtn.onclick = () => {
                    groupSavingModal.classList.add('hidden');
                    confirmDeleteItem(id, 'group');
                };
            }
            
            // Add member to list (for group saving form)
            function addMemberToList(email) {
                const membersList = document.getElementById('members-list');
                const memberItem = document.createElement('div');
                memberItem.className = 'flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-700 rounded-md member-item';
                memberItem.setAttribute('data-email', email);
                
                memberItem.innerHTML = `
                    <div class="flex items-center">
                        <div class="h-6 w-6 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs mr-2">
                            ${email.charAt(0).toUpperCase()}
                        </div>
                        <span class="text-sm">${email}</span>
                    </div>
                    <button type="button" class="text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:text-red-500 remove-member">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                membersList.appendChild(memberItem);
                
                // Add event listener to remove button
                memberItem.querySelector('.remove-member').addEventListener('click', () => {
                    memberItem.remove();
                });
            }
            
            // Add member button event listener
            const addMemberBtn = document.getElementById('add-member-btn');
            const groupMembersInput = document.getElementById('group-members');
            
            addMemberBtn.addEventListener('click', () => {
                const email = groupMembersInput.value.trim();
                if (email) {
                    addMemberToList(email);
                    groupMembersInput.value = '';
                }
            });
            
            // Open transaction modal (deposit/withdraw)
            function openTransactionModal(type, savingId = null, transactionId = null) {
                // Set transaction type
                transactionType.value = type;
                
                // Reset form
                document.getElementById('transaction-id').value = '';
                document.getElementById('transaction-saving').value = '';
                document.getElementById('transaction-amount').value = '';
                document.getElementById('transaction-date').valueAsDate = new Date();
                document.getElementById('transaction-payment-method').value = 'bank';
                document.getElementById('transaction-notes').value = '';
                
                // Set modal title and amount label based on type
                transactionModalTitle.textContent = type === 'deposit' ? 'Tambah Setoran' : 'Tambah Penarikan';
                transactionAmountLabel.textContent = type === 'deposit' ? 'Jumlah Setoran (Rp)' : 'Jumlah Penarikan (Rp)';
                
                // Hide delete button by default
                deleteTransactionBtn.classList.add('hidden');
                
                // If editing existing transaction
                if (transactionId) {
                    const transaction = DB.getTransactionById(transactionId);
                    if (transaction) {
                        document.getElementById('transaction-id').value = transaction.id;
                        document.getElementById('transaction-saving').value = transaction.savingId;
                        document.getElementById('transaction-amount').value = transaction.amount;
                        document.getElementById('transaction-date').value = transaction.date;
                        document.getElementById('transaction-payment-method').value = transaction.paymentMethod;
                        document.getElementById('transaction-notes').value = transaction.notes || '';
                        
                        transactionModalTitle.textContent = transaction.type === 'deposit' ? 'Edit Setoran' : 'Edit Penarikan';
                        
                        // Show delete button
                        deleteTransactionBtn.classList.remove('hidden');
                        deleteTransactionBtn.setAttribute('data-id', transaction.id);
                        
                        // Set delete button action
                        deleteTransactionBtn.onclick = () => {
                            transactionModal.classList.add('hidden');
                            confirmDeleteItem(transaction.id, 'transaction');
                        };
                    }
                }
                // If adding new transaction for specific saving
                else if (savingId) {
                    document.getElementById('transaction-saving').value = savingId;
                }
                
                // Show modal
                transactionModal.classList.remove('hidden');
            }
            
            // Edit transaction
            function editTransaction(id) {
                const transaction = DB.getTransactionById(id);
                if (transaction) {
                    openTransactionModal(transaction.type, null, id);
                }
            }
            
            // Update transaction saving dropdown
            function updateTransactionSavingDropdown() {
                const dropdown = document.getElementById('transaction-saving');
                dropdown.innerHTML = '<option value="">-- Pilih Tabungan --</option>';
                
                // Add personal savings
                const personalSavings = DB.getPersonalSavings();
                if (personalSavings.length > 0) {
                    const personalGroup = document.createElement('optgroup');
                    personalGroup.label = 'Tabungan Pribadi';
                    
                    personalSavings.forEach(saving => {
                        const option = document.createElement('option');
                        option.value = saving.id;
                        option.textContent = saving.name;
                        personalGroup.appendChild(option);
                    });
                    
                    dropdown.appendChild(personalGroup);
                }
                
                // Add group savings
                const groupSavings = DB.getGroupSavings();
                if (groupSavings.length > 0) {
                    const groupGroup = document.createElement('optgroup');
                    groupGroup.label = 'Tabungan Bersama';
                    
                    groupSavings.forEach(saving => {
                        const option = document.createElement('option');
                        option.value = saving.id;
                        option.textContent = saving.name;
                        groupGroup.appendChild(option);
                    });
                    
                    dropdown.appendChild(groupGroup);
                }
                
                // Also update transaction filter dropdown
                updateTransactionFilterDropdowns();
            }
            
            // Update transaction filter dropdowns
            function updateTransactionFilterDropdowns() {
                const savingDropdown = document.getElementById('transaction-saving-filter');
                savingDropdown.innerHTML = '<option value="all">Semua Tabungan</option>';
                
                // Add personal savings
                const personalSavings = DB.getPersonalSavings();
                if (personalSavings.length > 0) {
                    const personalGroup = document.createElement('optgroup');
                    personalGroup.label = 'Tabungan Pribadi';
                    
                    personalSavings.forEach(saving => {
                        const option = document.createElement('option');
                        option.value = saving.id;
                        option.textContent = saving.name;
                        personalGroup.appendChild(option);
                    });
                    
                    savingDropdown.appendChild(personalGroup);
                }
                
                // Add group savings
                const groupSavings = DB.getGroupSavings();
                if (groupSavings.length > 0) {
                    const groupGroup = document.createElement('optgroup');
                    groupGroup.label = 'Tabungan Bersama';
                    
                    groupSavings.forEach(saving => {
                        const option = document.createElement('option');
                        option.value = saving.id;
                        option.textContent = saving.name;
                        groupGroup.appendChild(option);
                    });
                    
                    savingDropdown.appendChild(groupGroup);
                }
            }
            
            // Load and render transactions
            function loadTransactions() {
                // Get filter values
                const typeFilter = document.getElementById('transaction-type-filter').value;
                const savingFilter = document.getElementById('transaction-saving-filter').value;
                const dateFilter = document.getElementById('transaction-date-filter').value;
                
                const filters = {
                    type: typeFilter,
                    savingId: savingFilter,
                    dateRange: dateFilter
                };
                
                const transactions = DB.getFilteredTransactions(filters);
                const tbody = document.getElementById('transactions-tbody');
                const countEl = document.getElementById('transaction-count');
                
                // Update count
                countEl.textContent = transactions.length;
                
                // Clear previous rows
                tbody.innerHTML = '';
                
                if (transactions.length === 0) {
                    const emptyRow = document.createElement('tr');
                    emptyRow.innerHTML = `
                        <td colspan="5" class="px-6 py-10 text-center text-gray-500 dark:text-gray-400">
                            Tidak ada transaksi untuk ditampilkan
                        </td>
                    `;
                    tbody.appendChild(emptyRow);
                    return;
                }
                
                // Add transaction rows
                transactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                    
                    // Format date
                    const formattedDate = DB.formatDate(transaction.date);
                    
                    // Get saving name
                    const savingName = DB.getSavingNameById(transaction.savingId);
                    
                    // Format amount with currency
                    const formattedAmount = DB.formatCurrency(transaction.amount);
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${formattedDate}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${savingName}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs rounded-full ${transaction.type === 'deposit' ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300' : 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300'}">
                                ${transaction.type === 'deposit' ? 'Setoran' : 'Penarikan'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right ${transaction.type === 'deposit' ? 'text-green-500' : 'text-red-500'}">
                            ${transaction.type === 'deposit' ? '+' : '-'} ${formattedAmount}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <button class="text-accent-500 hover:text-accent-600 view-transaction" data-id="${transaction.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="text-gray-500 hover:text-gray-600 ml-3 edit-transaction" data-id="${transaction.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-600 ml-3 delete-transaction" data-id="${transaction.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                // Add event listeners to buttons
                const viewBtns = document.querySelectorAll('.view-transaction');
                const editBtns = document.querySelectorAll('.edit-transaction');
                const deleteBtns = document.querySelectorAll('.delete-transaction');
                
                viewBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        openTransactionDetailModal(id);
                    });
                });
                
                editBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        editTransaction(id);
                    });
                });
                
                deleteBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        confirmDeleteItem(id, 'transaction');
                    });
                });
            }
            
            // Transaction filter change event
            document.getElementById('transaction-type-filter').addEventListener('change', loadTransactions);
            document.getElementById('transaction-saving-filter').addEventListener('change', loadTransactions);
            document.getElementById('transaction-date-filter').addEventListener('change', loadTransactions);
            
            // Load recent activities on dashboard
            function loadRecentActivities() {
                const container = document.getElementById('recent-activities');
                container.innerHTML = '';
                
                const recentTransactions = DB.getRecentTransactions(5);
                
                if (recentTransactions.length === 0) {
                    container.innerHTML = `
                        <div class="flex items-center justify-center h-20">
                            <p class="text-gray-500 dark:text-gray-400 text-sm">Tidak ada aktivitas terbaru</p>
                        </div>
                    `;
                    return;
                }
                
                recentTransactions.forEach(transaction => {
                    const savingName = DB.getSavingNameById(transaction.savingId);
                    const date = new Date(transaction.timestamp);
                    
                    let timeAgo;
                    const now = new Date();
                    const diffMs = now - date;
                    const diffSec = Math.floor(diffMs / 1000);
                    const diffMin = Math.floor(diffSec / 60);
                    const diffHour = Math.floor(diffMin / 60);
                    const diffDay = Math.floor(diffHour / 24);
                    
                    if (diffDay > 0) {
                        timeAgo = diffDay === 1 ? 'Kemarin' : `${diffDay} hari yang lalu`;
                    } else if (diffHour > 0) {
                        timeAgo = `${diffHour} jam yang lalu`;
                    } else if (diffMin > 0) {
                        timeAgo = `${diffMin} menit yang lalu`;
                    } else {
                        timeAgo = 'Baru saja';
                    }
                    
                    const formattedTime = date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                    const timeDisplay = diffDay > 0 ? timeAgo : `${timeAgo}, ${formattedTime}`;
                    
                    const item = document.createElement('div');
                    item.className = 'flex items-start';
                    
                    if (transaction.type === 'deposit') {
                        item.innerHTML = `
                            <div class="h-8 w-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-500 mr-3 flex-shrink-0">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="flex-grow">
                                <p class="text-sm font-medium">Setoran ke "${savingName}"</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">${timeDisplay}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-medium text-green-500">+ ${DB.formatCurrency(transaction.amount)}</p>
                            </div>
                        `;
                    } else {
                        item.innerHTML = `
                            <div class="h-8 w-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-red-500 mr-3 flex-shrink-0">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="flex-grow">
                                <p class="text-sm font-medium">Penarikan dari "${savingName}"</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">${timeDisplay}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-medium text-red-500">- ${DB.formatCurrency(transaction.amount)}</p>
                            </div>
                        `;
                    }
                    
                    container.appendChild(item);
                });
            }
            
            // Update dashboard totals
            function updateDashboard() {
                const personalTotal = document.getElementById('dashboard-personal-total');
                const groupTotal = document.getElementById('dashboard-group-total');
                const personalGrowth = document.getElementById('dashboard-personal-growth');
                const groupGrowth = document.getElementById('dashboard-group-growth');
                
                personalTotal.textContent = DB.formatCurrency(DB.getPersonalTotalBalance());
                groupTotal.textContent = DB.formatCurrency(DB.getGroupTotalBalance());
                personalGrowth.textContent = DB.getPersonalGrowthRate() + '%';
                groupGrowth.textContent = DB.getGroupGrowthRate() + '%';
                
                // Reinitialize chart
                initializeChart(document.getElementById('chart-period').value);
                
                // Load recent activities
                loadRecentActivities();
            }
            
            // Chart period change
            document.getElementById('chart-period').addEventListener('change', function() {
                initializeChart(this.value);
            });
            
            // Theme toggle
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                initializeChart(document.getElementById('chart-period').value); // Reinitialize chart on theme change
            });
            
            // User dropdown
            const userMenuBtn = document.getElementById('user-menu-btn');
            const userDropdown = document.getElementById('user-dropdown');
            userMenuBtn.addEventListener('click', () => {
                userDropdown.classList.toggle('hidden');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
                    userDropdown.classList.add('hidden');
                }
            });
            
            // Notification panel
            const notificationBtn = document.getElementById('notification-btn');
            const notificationPanel = document.getElementById('notification-panel');
            const notificationClose = document.getElementById('notification-close');
            
            notificationBtn.addEventListener('click', () => {
                notificationPanel.classList.toggle('translate-x-full');
                
                // Mark all notifications as read when panel is opened
                if (!notificationPanel.classList.contains('translate-x-full')) {
                    DB.markAllNotificationsAsRead();
                }
            });
            
            notificationClose.addEventListener('click', () => {
                notificationPanel.classList.add('translate-x-full');
            });
            
            // Load notifications
            function loadNotifications() {
                const container = document.getElementById('notifications-container');
                container.innerHTML = '';
                
                const notifications = DB.getNotifications();
                
                if (notifications.length === 0) {
                    container.innerHTML = `
                        <div class="flex items-center justify-center h-20">
                            <p class="text-gray-500 dark:text-gray-400 text-sm">Tidak ada notifikasi</p>
                        </div>
                    `;
                    return;
                }
                
                notifications.forEach(notification => {
                    const date = new Date(notification.timestamp);
                    
                    let timeAgo;
                    const now = new Date();
                    const diffMs = now - date;
                    const diffSec = Math.floor(diffMs / 1000);
                    const diffMin = Math.floor(diffSec / 60);
                    const diffHour = Math.floor(diffMin / 60);
                    const diffDay = Math.floor(diffHour / 24);
                    
                    if (diffDay > 0) {
                        timeAgo = diffDay === 1 ? 'Kemarin' : `${diffDay} hari yang lalu`;
                    } else if (diffHour > 0) {
                        timeAgo = `${diffHour} jam yang lalu`;
                    } else if (diffMin > 0) {
                        timeAgo = `${diffMin} menit yang lalu`;
                    } else {
                        timeAgo = 'Baru saja';
                    }
                    
                    const typeColorMap = {
                        success: 'green',
                        info: 'blue',
                        warning: 'yellow',
                        error: 'red',
                        reward: 'purple',
                        ai: 'indigo'
                    };
                    
                    const color = typeColorMap[notification.type] || 'blue';
                    
                    const item = document.createElement('div');
                    item.className = `p-3 bg-${color}-50 dark:bg-${color}-900/20 rounded-lg border-l-4 border-${color}-500 ${notification.read ? '' : 'font-medium'}`;
                    
                    item.innerHTML = `
                        <div class="flex justify-between items-start">
                            <p class="text-sm font-medium">${notification.title}</p>
                            <span class="text-xs text-gray-500 dark:text-gray-400">${timeAgo}</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-300 mt-1">${notification.message}</p>
                    `;
                    
                    container.appendChild(item);
                });
                
                // Update notification badge
                DB.updateNotificationBadge();
            }
            
            // Personal saving modal open/close
            const addPersonalSavingBtn = document.getElementById('add-personal-saving-btn');
            const addPersonalCard = document.getElementById('add-personal-card');
            const emptyAddPersonalBtn = document.getElementById('empty-add-personal-btn');
            
            function openPersonalSavingModal(isEditing = false) {
                // Reset form if not editing
                if (!isEditing) {
                    document.getElementById('personal-saving-id').value = '';
                    document.getElementById('saving-name').value = '';
                    document.getElementById('saving-category').value = 'liburan';
                    document.getElementById('saving-target').value = '';
                    document.getElementById('saving-deadline').value = '';
                    document.getElementById('saving-init').value = '';
                    document.getElementById('saving-notes').value = '';
                    
                    // Update modal title and hide delete button
                    personalSavingModalTitle.textContent = 'Tambah Tabungan Baru';
                    deletePersonalSavingBtn.classList.add('hidden');
                }
                
                personalSavingModal.classList.remove('hidden');
            }
            
            addPersonalSavingBtn.addEventListener('click', () => openPersonalSavingModal());
            addPersonalCard.addEventListener('click', () => openPersonalSavingModal());
            emptyAddPersonalBtn.addEventListener('click', () => openPersonalSavingModal());
            
            // Group saving modal open/close
            const addGroupSavingBtn = document.getElementById('add-group-saving-btn');
            const addGroupCard = document.getElementById('add-group-card');
            const emptyAddGroupBtn = document.getElementById('empty-add-group-btn');
            
            function openGroupSavingModal(isEditing = false) {
                // Reset form if not editing
                if (!isEditing) {
                    document.getElementById('group-saving-id').value = '';
                    document.getElementById('group-name').value = '';
                    document.getElementById('group-category').value = 'liburan';
                    document.getElementById('group-target').value = '';
                    document.getElementById('group-deadline').value = '';
                    document.getElementById('group-privacy').checked = false;
                    
                    // Clear members list
                    document.getElementById('members-list').innerHTML = '';
                    
                    // Update modal title and hide delete button
                    groupSavingModalTitle.textContent = 'Buat Grup Tabungan Baru';
                    deleteGroupSavingBtn.classList.add('hidden');
                }
                
                groupSavingModal.classList.remove('hidden');
            }
            
            addGroupSavingBtn.addEventListener('click', () => openGroupSavingModal());
            addGroupCard.addEventListener('click', () => openGroupSavingModal());
            emptyAddGroupBtn.addEventListener('click', () => openGroupSavingModal());
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === personalSavingModal) {
                    personalSavingModal.classList.add('hidden');
                }
                if (e.target === groupSavingModal) {
                    groupSavingModal.classList.add('hidden');
                }
                if (e.target === transactionModal) {
                    transactionModal.classList.add('hidden');
                }
            });
            
            // Close modals with X button
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const modal = btn.closest('.fixed');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                });
            });
            
            document.getElementById('transaction-close').addEventListener('click', () => {
                transactionModal.classList.add('hidden');
            });
            
            // Open transaction modal buttons
            document.getElementById('add-deposit-btn').addEventListener('click', () => {
                openTransactionModal('deposit');
            });
            
            document.getElementById('add-withdraw-btn').addEventListener('click', () => {
                openTransactionModal('withdraw');
            });
            
            // View all transactions link
            document.getElementById('view-all-transactions').addEventListener('click', (e) => {
                e.preventDefault();
                
                // Click on the transactions tab
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (btn.getAttribute('data-tab') === 'transaction-tab') {
                        btn.click();
                    }
                });
            });
            
            // PIN Authentication
            const authScreen = document.getElementById('auth-screen');
            const pinButtons = document.querySelectorAll('.pin-button');
            const pinDots = document.querySelectorAll('.pin-dot');
            const backspaceBtn = document.getElementById('backspace-btn');
            const biometricBtn = document.getElementById('biometric-btn');
            const pinError = document.getElementById('pin-error');
            
            let currentPin = '';
            const correctPin = '1234'; // For demo purposes
            
            function updatePinDots() {
                pinDots.forEach((dot, index) => {
                    if (index < currentPin.length) {
                        dot.innerHTML = '';
                        dot.classList.add('border-accent-500');
                    } else {
                        dot.innerHTML = '';
                        dot.classList.remove('border-accent-500');
                    }
                });
            }
            
            function checkPin() {
                if (currentPin === correctPin) {
                    authScreen.classList.add('hidden');
                    
                    // Show 2FA verification for added security
                    document.getElementById('twofa-modal').classList.remove('hidden');
                } else {
                    // Show error animation
                    pinDots.forEach(dot => dot.classList.add('shake'));
                    pinError.classList.remove('hidden');
                    
                    // Reset PIN after showing error
                    setTimeout(() => {
                        currentPin = '';
                        updatePinDots();
                        pinDots.forEach(dot => dot.classList.remove('shake'));
                    }, 500);
                }
            }
            
            pinButtons.forEach(button => {
                button.addEventListener('click', () => {
                    pinError.classList.add('hidden');
                    if (currentPin.length < 4) {
                        currentPin += button.textContent.trim();
                        updatePinDots();
                        
                        if (currentPin.length === 4) {
                            checkPin();
                        }
                    }
                });
            });
            
            backspaceBtn.addEventListener('click', () => {
                if (currentPin.length > 0) {
                    currentPin = currentPin.slice(0, -1);
                    updatePinDots();
                    pinError.classList.add('hidden');
                }
            });
            
            biometricBtn.addEventListener('click', () => {
                // Simulate biometric auth
                biometricBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                setTimeout(() => {
                    biometricBtn.innerHTML = '<i class="fas fa-fingerprint"></i>';
                    authScreen.classList.add('hidden');
                    
                    // Skip 2FA for biometric login
                    initializeApp(); // Initialize app data after successful login
                }, 1500);
            });
            
            // 2FA Verification
            const twofaInputs = document.querySelectorAll('.twofa-input');
            const twofaVerifyBtn = document.getElementById('twofa-verify');
            const twofaCancelBtn = document.getElementById('twofa-cancel');
            const twofaModal = document.getElementById('twofa-modal');
            
            // Auto-focus next input when typing
            twofaInputs.forEach((input, index) => {
                input.addEventListener('input', () => {
                    if (input.value && index < twofaInputs.length - 1) {
                        twofaInputs[index + 1].focus();
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !input.value && index > 0) {
                        twofaInputs[index - 1].focus();
                    }
                });
            });
            
            twofaVerifyBtn.addEventListener('click', () => {
                let code = '';
                twofaInputs.forEach(input => {
                    code += input.value;
                });
                
                if (code === '123456') { // For demo purposes
                    twofaModal.classList.add('hidden');
                    showNotification('Autentikasi berhasil!', 'success');
                    
                    // Initialize app data after successful login
                    initializeApp();
                    
                    // After login, award security badge
                    setTimeout(() => {
                        showBadgeAchievement('fa-shield-alt', 'Security Conscious', 'Mengaktifkan autentikasi dua faktor');
                    }, 2000);
                } else {
                    // Show error for wrong code
                    twofaInputs.forEach(input => {
                        input.classList.add('border-red-500');
                        setTimeout(() => {
                            input.classList.remove('border-red-500');
                            input.value = '';
                        }, 1000);
                    });
                    twofaInputs[0].focus();
                }
            });
            
            twofaCancelBtn.addEventListener('click', () => {
                twofaModal.classList.add('hidden');
                authScreen.classList.remove('hidden');
                currentPin = '';
                updatePinDots();
                twofaInputs.forEach(input => {
                    input.value = '';
                });
            });
            
            // Logout
            const logoutBtn = document.getElementById('logout-btn');
            logoutBtn.addEventListener('click', () => {
                authScreen.classList.remove('hidden');
                userDropdown.classList.add('hidden');
                currentPin = '';
                updatePinDots();
                twofaInputs.forEach(input => {
                    input.value = '';
                });
            });
            
            // App info modal
            const appInfoBtn = document.getElementById('app-info-btn');
            const appInfoModal = document.getElementById('app-info-modal');
            const appInfoClose = document.getElementById('app-info-close');
            
            appInfoBtn.addEventListener('click', () => {
                appInfoModal.classList.remove('hidden');
            });
            
            appInfoClose.addEventListener('click', () => {
                appInfoModal.classList.add('hidden');
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === appInfoModal) {
                    appInfoModal.classList.add('hidden');
                }
            });
            
            // Badge achievement modal
            const badgeModal = document.getElementById('badge-modal');
            const badgeClose = document.getElementById('badge-close');
            const badgeShare = document.getElementById('badge-share');
            const badgeIcon = document.getElementById('badge-icon');
            const badgeTitle = document.getElementById('badge-title');
            const badgeDesc = document.getElementById('badge-description');
            
            function showBadgeAchievement(icon, title, description) {
                badgeIcon.className = `fas ${icon} text-accent-500 text-5xl`;
                badgeTitle.textContent = title;
                badgeDesc.textContent = description;
                badgeModal.classList.remove('hidden');
                
                // Create confetti effect
                createConfetti();
                
                // Add notification
                DB.addNotification({
                    type: 'reward',
                    title: 'Badge Baru',
                    message: `Selamat! Anda mendapatkan badge "${title}"`
                });
                
                // Update notifications display
                loadNotifications();
            }
            
            badgeClose.addEventListener('click', () => {
                badgeModal.classList.add('hidden');
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === badgeModal) {
                    badgeModal.classList.add('hidden');
                }
            });
            
            // Share modal
            const shareModal = document.getElementById('share-modal');
            const shareClose = document.getElementById('share-close');
            const shareIcon = document.getElementById('share-icon');
            const shareTitle = document.getElementById('share-title');
            const shareDesc = document.getElementById('share-description');
            const copyLinkBtn = document.getElementById('copy-link-btn');
            
            badgeShare.addEventListener('click', () => {
                // Copy badge details to share modal
                shareIcon.className = badgeIcon.className;
                shareTitle.textContent = badgeTitle.textContent;
                shareDesc.textContent = badgeDesc.textContent;
                
                badgeModal.classList.add('hidden');
                shareModal.classList.remove('hidden');
            });
            
            shareClose.addEventListener('click', () => {
                shareModal.classList.add('hidden');
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === shareModal) {
                    shareModal.classList.add('hidden');
                }
            });
            
            copyLinkBtn.addEventListener('click', () => {
                const linkInput = copyLinkBtn.previousElementSibling;
                linkInput.select();
                document.execCommand('copy');
                
                // Change button to indicate success
                const originalHTML = copyLinkBtn.innerHTML;
                copyLinkBtn.innerHTML = '<i class="fas fa-check"></i>';
                copyLinkBtn.classList.add('bg-green-500');
                copyLinkBtn.classList.remove('bg-accent-500', 'hover:bg-accent-600');
                
                setTimeout(() => {
                    copyLinkBtn.innerHTML = originalHTML;
                    copyLinkBtn.classList.remove('bg-green-500');
                    copyLinkBtn.classList.add('bg-accent-500', 'hover:bg-accent-600');
                }, 2000);
                
                showNotification('Link berhasil disalin ke clipboard!', 'success');
            });
            
            // Create confetti effect
            function createConfetti() {
                const confettiContainer = document.createElement('div');
                confettiContainer.style.position = 'fixed';
                confettiContainer.style.inset = '0';
                confettiContainer.style.pointerEvents = 'none';
                confettiContainer.style.zIndex = '60';
                document.body.appendChild(confettiContainer);
                
                const colors = ['#ff5252', '#ffeb3b', '#2196f3', '#4caf50', '#9c27b0', '#3f51b5'];
                
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.backgroundColor = color;
                    
                    // Random size
                    const size = Math.random() * 10 + 5;
                    confetti.style.width = `${size}px`;
                    confetti.style.height = `${size}px`;
                    
                    // Random position
                    confetti.style.left = `${Math.random() * 100}%`;
                    
                    // Random shape
                    const shapeRandom = Math.random();
                    if (shapeRandom > 0.66) {
                        confetti.style.borderRadius = '50%';
                    } else if (shapeRandom > 0.33) {
                        confetti.style.borderRadius = '0';
                    } else {
                        confetti.style.width = '0';
                        confetti.style.height = '0';
                        confetti.style.borderLeft = `${size}px solid transparent`;
                        confetti.style.borderRight = `${size}px solid transparent`;
                        confetti.style.borderBottom = `${size * 2}px solid ${color}`;
                        confetti.style.backgroundColor = 'transparent';
                    }
                    
                    // Random animation duration and delay
                    const duration = Math.random() * 2 + 2;
                    const delay = Math.random() * 0.5;
                    confetti.style.animation = `confetti-fall ${duration}s ease-in-out ${delay}s forwards`;
                    
                    confettiContainer.appendChild(confetti);
                }
                
                // Remove confetti after animations
                setTimeout(() => {
                    confettiContainer.remove();
                }, 5000);
            }
            
            // AI Advisor tab
            const viewAdvisorBtn = document.getElementById('view-advisor-btn');
            viewAdvisorBtn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (btn.getAttribute('data-tab') === 'advisor-tab') {
                        btn.click();
                    }
                });
            });
            
            // Chat form
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            
            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const message = chatInput.value.trim();
                if (!message) return;
                
                // Add user message
                const chatMessages = document.getElementById('chat-messages');
                const userMessage = document.createElement('div');
                userMessage.className = 'flex items-start justify-end';
                userMessage.innerHTML = `
                    <div class="bg-accent-500 text-white rounded-lg rounded-tr-none p-3 max-w-[85%]">
                        <p class="text-sm">${message}</p>
                    </div>
                    <div class="h-8 w-8 rounded-full bg-accent-500 flex items-center justify-center text-white ml-2 flex-shrink-0">
                        <i class="fas fa-user text-sm"></i>
                    </div>
                `;
                chatMessages.appendChild(userMessage);
                chatInput.value = '';
                
                // Show typing indicator
                document.getElementById('typing-indicator').classList.remove('hidden');
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Simulate AI response after delay
                setTimeout(() => {
                    document.getElementById('typing-indicator').classList.add('hidden');
                    
                    // Add AI response
                    const aiResponse = document.createElement('div');
                    aiResponse.className = 'flex items-start';
                    
                    // Create different responses based on keywords in message
                    let responseContent = '';
                    if (message.toLowerCase().includes('tabung') || message.toLowerCase().includes('hemat')) {
                        responseContent = `
                            <p class="text-sm">Berikut beberapa tips menabung yang efektif untuk Anda:</p>
                            <ul class="list-disc pl-4 mt-2 text-sm space-y-1">
                                <li>Atur auto debit 1 hari setelah gajian sebesar 20% pendapatan</li>
                                <li>Gunakan metode 50/30/20 (kebutuhan/keinginan/tabungan)</li>
                                <li>Tantangan 52 minggu: mulai dari Rp 10.000, tambah Rp 10.000 setiap minggu</li>
                                <li>Alokasikan pendapatan tambahan langsung ke tabungan</li>
                            </ul>
                            <p class="text-sm mt-2">Mulai dari langkah kecil dan konsisten. Mau saya buatkan jadwal menabung personal untuk Anda?</p>
                        `;
                    } else if (message.toLowerCase().includes('investasi') || message.toLowerCase().includes('invest')) {
                        responseContent = `
                            <p class="text-sm">Untuk memulai investasi, pertimbangkan pilihan berikut sesuai profil risiko Anda:</p>
                            <ul class="list-disc pl-4 mt-2 text-sm space-y-1">
                                <li><strong>Risiko Rendah:</strong> Reksa Dana Pasar Uang, SBN, Deposito</li>
                                <li><strong>Risiko Menengah:</strong> Reksa Dana Campuran, Obligasi</li>
                                <li><strong>Risiko Tinggi:</strong> Reksa Dana Saham, Saham langsung</li>
                            </ul>
                            <p class="text-sm mt-2">Berdasarkan profil Anda, saya sarankan mulai dengan alokasi 60% Reksa Dana Pasar Uang dan 40% Reksa Dana Pendapatan Tetap. Sesuaikan seiring peningkatan pemahaman Anda tentang investasi.</p>
                        `;
                    } else if (message.toLowerCase().includes('target') || message.toLowerCase().includes('cepat')) {
                        responseContent = `
                            <p class="text-sm">Untuk mencapai target tabungan lebih cepat, coba strategi berikut:</p>
                            <ul class="list-disc pl-4 mt-2 text-sm space-y-1">
                                <li>Tingkatkan setoran bulanan untuk "Liburan Bali" menjadi Rp 1.000.000</li>
                                <li>Tetapkan reminder mingguan untuk setoran tambahan kecil</li>
                                <li>Alokasikan 80% dari pendapatan tidak terduga (bonus, THR) ke tabungan target</li>
                                <li>Evaluasi pengeluaran non-esensial yang bisa dialihkan ke tabungan</li>
                            </ul>
                            <p class="text-sm mt-2">Dengan pendekatan ini, target "Liburan Bali" bisa tercapai dalam 1,5 bulan (vs 3 bulan dalam rencana awal).</p>
                        `;
                    } else {
                        responseContent = `
                            <p class="text-sm">Berdasarkan analisis pola keuangan Anda, saya merekomendasikan:</p>
                            <ul class="list-disc pl-4 mt-2 text-sm space-y-1">
                                <li>Tetapkan anggaran bulanan untuk setiap kategori pengeluaran</li>
                                <li>Prioritaskan pelunasan utang dengan bunga tinggi</li>
                                <li>Buat dana darurat minimal 3x pengeluaran bulanan</li>
                                <li>Alokasikan minimal 20% pendapatan untuk tabungan dan investasi</li>
                            </ul>
                            <p class="text-sm mt-2">Saya juga melihat bahwa Anda bisa menghemat sekitar Rp 350.000/bulan dari layanan berlangganan yang jarang digunakan. Mau saya buatkan rencana optimalisasi pengeluaran?</p>
                        `;
                    }
                    
                    aiResponse.innerHTML = `
                        <div class="h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-500 mr-2 flex-shrink-0">
                            <i class="fas fa-robot text-sm"></i>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg rounded-tl-none p-3 max-w-[85%]">
                            ${responseContent}
                        </div>
                    `;
                    chatMessages.appendChild(aiResponse);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Add AI notification
                    DB.addNotification({
                        type: 'ai',
                        title: 'AI Advisor',
                        message: 'Rekomendasi baru tersedia dari AI Advisor Anda'
                    });
                    
                    // Update notifications
                    loadNotifications();
                }, 2000);
            });
            
            // Notification function
            function showNotification(message, type = 'info') {
                const notificationContainer = document.createElement('div');
                notificationContainer.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg max-w-xs z-50 fadeIn ${
                    type === 'success' ? 'bg-green-100 dark:bg-green-900/30 border-l-4 border-green-500' : 
                    type === 'error' ? 'bg-red-100 dark:bg-red-900/30 border-l-4 border-red-500' : 
                    'bg-blue-100 dark:bg-blue-900/30 border-l-4 border-blue-500'
                }`;
                notificationContainer.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0 mr-3">
                            <i class="fas ${
                                type === 'success' ? 'fa-check-circle text-green-500' : 
                                type === 'error' ? 'fa-exclamation-circle text-red-500' : 
                                'fa-info-circle text-blue-500'
                            }"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium">${message}</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(notificationContainer);
                
                setTimeout(() => {
                    notificationContainer.style.opacity = '0';
                    notificationContainer.style.transform = 'translateY(-20px)';
                    notificationContainer.style.transition = 'opacity 0.3s, transform 0.3s';
                    setTimeout(() => {
                        notificationContainer.remove();
                    }, 300);
                }, 3000);
            }

            // Tab navigation - Fixed to work properly
            function setupTabNavigation() {
                const tabBtns = document.querySelectorAll('.tab-btn');
                const tabContents = document.querySelectorAll('.tab-content');
                
                tabBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        // First, remove the active class from all tab buttons
                        tabBtns.forEach(b => {
                            b.classList.remove('border-accent-500', 'text-accent-500');
                            b.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
                        });
                        
                        // Then, add the active class to the clicked tab button
                        btn.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
                        btn.classList.add('border-accent-500', 'text-accent-500');
                        
                        // Hide all tab contents
                        tabContents.forEach(content => {
                            content.classList.add('hidden');
                        });
                        
                        // Show the corresponding tab content
                        const tabId = btn.getAttribute('data-tab');
                        const tabContent = document.getElementById(tabId);
                        if (tabContent) {
                            tabContent.classList.remove('hidden');
                        }
                        
                        // Reinitialize chart if on dashboard tab
                        if (tabId === 'dashboard-tab') {
                            initializeChart(document.getElementById('chart-period').value);
                        }
                        
                        // Hide typing indicator and maybe show AI response if on advisor tab
                        if (tabId === 'advisor-tab') {
                            setTimeout(() => {
                                document.getElementById('typing-indicator').classList.add('hidden');
                                
                                // Add AI response after typing animation
                                const chatMessages = document.getElementById('chat-messages');
                                
                                // Check if the AI response is already there
                                if (!chatMessages.querySelector('.ai-response-anggaran')) {
                                    const aiResponse = document.createElement('div');
                                    aiResponse.className = 'flex items-start ai-response-anggaran';
                                    aiResponse.innerHTML = `
                                        <div class="h-8 w-8 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-500 mr-2 flex-shrink-0">
                                            <i class="fas fa-robot text-sm"></i>
                                        </div>
                                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg rounded-tl-none p-3 max-w-[85%]">
                                            <p class="text-sm">Berikut adalah rencana anggaran untuk Anda:</p>
                                            <ul class="list-disc pl-4 mt-2 text-sm space-y-1">
                                                <li><strong>Tabungan Wajib:</strong> 20% dari pendapatan (Rp 2.000.000/bulan)</li>
                                                <li><strong>Pendidikan:</strong> 15% dari pendapatan (Rp 1.500.000/bulan)</li>
                                                <li><strong>Kebutuhan pokok:</strong> 50% dari pendapatan (Rp 5.000.000/bulan)</li>
                                                <li><strong>Hiburan:</strong> 10% dari pendapatan (Rp 1.000.000/bulan)</li>
                                                <li><strong>Dana darurat:</strong> 5% dari pendapatan (Rp 500.000/bulan)</li>
                                            </ul>
                                            <p class="text-sm mt-2">Dengan rencana ini, Anda dapat mencapai target "Liburan Bali" dalam 3 bulan dan mempercepat "Dana Pendidikan" dalam 6 bulan lebih cepat. Apakah Anda ingin saya bantu menerapkan rencana ini?</p>
                                        </div>
                                    `;
                                    chatMessages.appendChild(aiResponse);
                                    chatMessages.scrollTop = chatMessages.scrollHeight;
                                    
                                    // Award Smart Saver badge for using AI Advisor
                                    setTimeout(() => {
                                        showBadgeAchievement('fa-robot', 'Smart Saver', 'Menggunakan AI Advisor untuk perencanaan finansial');
                                    }, 2000);
                                }
                            }, 3000);
                        }
                    });
                });
            }

            // Initialize after authentication (moved from document load)
            setupTabNavigation();
            
            // Skip authentication for testing (comment this out in production)
            // authScreen.classList.add('hidden');
            // initializeApp();
        });
    </script>
</body>
</html>